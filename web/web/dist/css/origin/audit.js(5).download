
/**
 * 查询审核信息，提交审核结果
 */
var co_audit;
(function (audit) {

    //#region 自定义变量
    /**
     * 参数集合
     * tableElement:绑定Table
     * projectId:课题编号
     * queryUrl:查询请求URL
     * queryParams:查询请求参数集合
     * entrust:委托人角色
     * submitUrl:提交审核结果URL
     * submitData:除审核结果、审核意见、课题编号、审核日志ID外，补充提交数据
     */
    var audit_options = {};

    /**
     * 审核成功后回调函数
     */
    var audit_callback;
    /**
     * 获取详情后回调函数
     */
    var detail_callback;
    /**
     * OperationLogType
     */
    var opeType = -1;

    /**
     * 上传实例
     */
    var audit_submitUploader;
    var audit_updateUploader;
    var audit_resetLastAuditStateUploader;
    //#endregion

    /**
     * 删除附件
     * @param {any} fileName
     */
    audit.delAttachmentClick = function(fileName) {
        $('body').append('<div id="delAttchmentBox" class="easyui-dialog" style=" text-align:center;width:400px;height:200px; padding: 10px; word-wrap:break-word;" data-options="closed:true,modal:true"></div>');

        $('#delAttchmentBox').text("你确定要删除附件（ " + fileName + " ）吗？").dialog({
            title: '删除附件',
            buttons: [
                {
                    text: '确定',
                    handler: function() {
                        $("#audit_scfj").html("上传审核有关附件，支持附件格式为doc，docx，pdf，wps，rar，zip。");
                        $("#audit_scfj").attr("AttachmentNum", "-1");
                        $("#delAttchmentBox").dialog("close");
                        $("#delAttchmentBox").remove();
                    }
                },
                {
                    text: '取消',
                    handler: function() {
                        $("#delAttchmentBox").dialog("close");
                        $("#delAttchmentBox").remove();
                    }
                }
            ]
        }).dialog("open").window('center');
    };

    /**
     * 提交审核 或者提交最终审核状态
     * @returns {} 
     */
    var audit_submit = function () {
        var opeKeyId = $(this).siblings(".hdOpeKeyId").val();
        var projectId = $(this).siblings(".hdOpeKeyId").attr('projectId');
        var isUpdateLastState = $(this).siblings(".hdOpeKeyId").attr('isUpdateLastState') || false;
        var auditState = $("._checkState_ input[name=rdoAudit]:checked").val();
        var isDesign = $(this).siblings(".designTableModel").attr('isDesign'); // 是否自定义
        var pdata = audit_options.submitData || {};
        if (isDesign == 'true') {
            var designTableModel = JSON.parse($(this).siblings(".designTableModel").val());
            submitDesignTableValue(designTableModel, pdata);
        } else {
            var auditSuggest = $(audit_options.tableElement).find("#txtAuditSuggest").textbox('getText');
            if (checkValIsUndefinedOrNull(auditSuggest)) {
                myMessage("审核意见不能为空");
                return;
            };
            pdata["suggestion"] = replaceUnequa(auditSuggest);
        };
        if (auditState != 1 && auditState != -1) {
            myMessage("请选择审核结果");
            return;
        };
        if (isUpdateLastState) {
            pdata['designTableInfo'] = $(this).siblings('.designTableModel').attr('aesdesigntableinfo');
            pdata["recheck"] = 0;
            pdata["resetLastAuditState"] = 1;
        } else {
            pdata["recheck"] = 0;
            pdata["resetLastAuditState"] = 0;
        }
        pdata["opeKeyId"] = opeKeyId;
        pdata["projectId"] = projectId;
        pdata["auditState"] = auditState;

        if (auditState == 1 && $("#txtUsualGrade").length > 0) { // 平时成绩
            var UsualGrade = $("#txtUsualGrade").textbox("getText");
            if ((!/^\d*\.{0,1}\d{0,1}$/.test(UsualGrade)) || UsualGrade < 0 || UsualGrade > 100) {
                myMessage("成绩只能是0-100的正整数,支持保留1位小数，请按照提示输入正确的成绩！");
                return;
            }
            pdata["score"] = UsualGrade;
        }
        pdata["entrust"] = audit_options.entrust;
        var fileId = $(audit_options.tableElement).find("#txtFileNameOfAudit").attr("fileId");
        open_loading();
        if ((audit_submitUploader || audit_resetLastAuditStateUploader) && !checkValIsUndefinedOrNull(fileId)) {
            pdata["ASPSESSID"] = getid();
            pdata["fileCount"] = 1;
            if (audit_submitUploader) {
                $.extend(audit_submitUploader.options.formData, pdata);
                audit_submitUploader.upload(fileId);
            }
            if (audit_resetLastAuditStateUploader) {
                $.extend(audit_resetLastAuditStateUploader.options.formData, pdata);
                audit_resetLastAuditStateUploader.upload(fileId);
            }
        } else {
            if ($("#audit_scfj").attr('AttachmentNum')) {
                pdata["fileCount"] = $("#audit_scfj").attr('AttachmentNum');
            } else {
                pdata["fileCount"] = 0;
            }
            $.ajax({
                url: audit_options.submitUrl,
                type: "post",
                data: pdata,
                dataType: "json",
                success: function(data) {
                    if (data) {
                        if (data.isSuccess) {
                            myMessage("审核成功", function () {
                                if (isUpdateLastState) {
                                    var tab = getCurrentTab();
                                    reloadTable(getUrlParam("prevTitle"), 'list');//刷新前一个页
                                    refreshTab2(tab);//刷新当前页
                                } else {
                                    var tabTitle = getCurrentTabTitle(); //当前tabTitle
                                    //刷新前一个页面
                                    var prevTitle = getUrlParam("prevTitle");
                                    reloadTable(prevTitle, 'list');
                                    closeTab(tabTitle);//关闭当前页
                                }
                            });
                        } else {
                            myMessage(data.message);
                        };
                    }
                },
                error: function(err) {
                    if (console && console.log) {
                        console.log(err.statusText);
                    }
                },
                complete: function () {
                    close_loading();
                }
            });
        }
    };

    /**
     * 取消修改
     */
    var audit_update_cancel = function () {
        refreshTab2(getCurrentTab());//刷新当前页
    };

    /**
     * 提交修改意见
     */
    var audit_update_submit = function () {
        var opeKeyId = $(this).siblings('.hdOpeKeyId').val();
        var projectId = $(this).siblings('.hdOpeKeyId').attr('projectId');
        var isDesign = $(this).siblings('.designTableModel').attr('isDesign'); // 是否自定义
        var pdata = {
            action: "UpdateAuditLog"
        };
        if (isDesign == 'true') {
            var designTableModel = JSON.parse($(this).siblings('.designTableModel').val());
            submitDesignTableValue(designTableModel, pdata);
            
        } else {
            var auditSuggest = $(audit_options.tableElement).find("#txtAuditSuggest").textbox('getText');
            if (checkValIsUndefinedOrNull(auditSuggest)) {
                myMessage("审核意见不能为空");
                return;
            };
            pdata["suggestion"] = replaceUnequa(auditSuggest);
        };
        pdata['designTableInfo'] = $(this).siblings('.designTableModel').attr('aesdesigntableinfo');
        pdata["opeKeyId"] = opeKeyId;
        pdata["projectId"] = projectId;
        var fileId = $(audit_options.tableElement).find("#txtFileNameOfAudit").attr("fileId");
        open_loading();
        if (audit_updateUploader && !checkValIsUndefinedOrNull(fileId)) {
            pdata["ASPSESSID"] = getid();
            pdata["fileCount"] = 1;
            $.extend(audit_updateUploader.options.formData, pdata);
            audit_updateUploader.upload(fileId);
        } else {
            pdata["fileCount"] = $("#audit_scfj").attr('AttachmentNum');
            $.ajax({
                url: '../Handler/AuditHandler.ashx',
                type: "post",
                data: pdata,
                dataType: "json",
                success: function (data) {
                    if (data.isSuccess) {
                        myMessage("修改成功", function () {
                            refreshTab2(getCurrentTab());//刷新当前页
                        });
                    } else {
                        myMessage(data.message);
                    };
                },
                error: function (err) {
                    if (console && console.log) {
                        console.log(err.statusText);
                    }
                },
                complete: function () {
                    close_loading();
                }
            });
        };
    };

    /**
     * 修改审核意见
     */
    var audit_update = function () {
        var thisBox = $(this).parent().parent().parent('.gxf_designTable_box');
        var aesdesigntableinfo = thisBox.find(".designTableModel").attr('aesdesigntableinfo'); // 是否自定义参数
        var details = thisBox.find(".designTableModel").val(); //详情
        var opeKeyId = thisBox.find(".hdOpeKeyId").val();
        var projectId = thisBox.find(".hdOpeKeyId").attr('projectId');
        var roleType = thisBox.find(".hdOpeKeyId").attr('roletype');
        var canUpload = false;
        var showAttachment = thisBox.find(".showAttachment").val();
        var checkState = thisBox.find(".hdOpeKeyId").attr('checkState');
        var attachmentHtml = "";
        if (showAttachment == 'true') {
            canUpload = true;
            attachmentHtml = '<li>';
            var fileName = thisBox.find(".showAttachment").attr('fileName');
            if (checkValIsUndefinedOrNull(fileName)) {
                attachmentHtml += '<p>添加附件：<span class="statement" id="audit_scfj" AttachmentNum = "0">新上传的文件将以附件的形式显示，支持附件格式为doc，docx，pdf，wps，rar，zip</span></p>';
            } else {
                attachmentHtml += '<p>添加附件：<span class="statement" id="audit_scfj" AttachmentNum = "0">已上传有关审核附件：<span style="color:#ff6632;">' + fileName + '<a href="javascript:co_audit.delAttachmentClick(\'' + fileName + '\');" class="listA margl">删除 </a></span>；'
                    + ' 新上传的文件将以附件的形式显示，支持附件格式为doc，docx，pdf，wps，rar，zip</span></p>';
            }
            attachmentHtml = attachmentHtml
                + '<input type="text" id="txtFileNameOfAudit" class="easyui-textbox" data-options="width:285,readonly:true" />'
                + '<span id="webUploaderPickOfAudit"></span>'
                + '<div id="divFileProgressContainerOfAudit" style=""></div>'
                + '</li>';
        }

        var html = '<li class="_checkState_">';
        html += '<p>审核状态</p>';
        html += '<div class="designTable_radio">';
        if (checkState == 1) {
            html += '<input id="rdoPass" class="margl" type="radio" name="rdoAudit" value="1" checked="checked" disabled="disabled"/><label for="rdoPass">通过</label>';
            html += '<input id="rdoUnPass" class="margl" type="radio" name="rdoAudit" value="-1" disabled="disabled"/><label for="rdoUnPass">' + getAuditStateText(-1, opeType).replace(/审核/g, '') + '</label>';
        } else if (checkState == -1) {
            html += '<input id="rdoPass" class="margl" type="radio" name="rdoAudit" value="1" disabled="disabled"/><label for="rdoPass">通过</label>';
            html += '<input id="rdoUnPass" class="margl" type="radio" name="rdoAudit" value="-1" checked="checked" disabled="disabled"/><label for="rdoUnPass">' + getAuditStateText(-1, opeType).replace(/审核/g, '') + '</label>';
        } else {
            html += '<input id="rdoPass" class="margl" type="radio" name="rdoAudit" value="1" disabled="disabled"/><label for="rdoPass">通过</label>';
            html += '<input id="rdoUnPass" class="margl" type="radio" name="rdoAudit" value="-1" disabled="disabled"/><label for="rdoUnPass">' + getAuditStateText(-1, opeType).replace(/审核/g, '') + '</label>';
        }
        
        html += '</div>';
        html += '</li>';
        $.ajax({
            url: "../Handler/DesignTableHandler.ashx",
            type: "post",
            data: {
                "action": "IshasSetDesignTableCommon",
                "designTableInfo": aesdesigntableinfo
            },
            dataType: "json"
        }).done(function (data) {
            if (data.isSuccess) {
                html += SetValueDesignTable(data.rows, JSON.parse(details)[0], "", true)['str'];
                if (showAttachment == 'true') {
                    html += attachmentHtml;
                };
            } else {
                html += '<li>';
                html += '<p>审核意见<span class="writerText margl"> 共输入<i style="color: #f00;"> ' + (details.replace(/\s|\r|\n/g, "").length) + ' </i>字符</span><span class="statement margl">请按照学校的要求，在下方输入相关内容，若无内容请填写“无”</span></p>';
                html += '<input id="txtAuditSuggest" type="text" class="easyui-textbox" data-options="multiline:true,height:100" style="width: 100%">';
                html += '</li>';
                if (showAttachment == 'true') {
                    html += attachmentHtml;
                };
            };

            html += "<li>";
            html += "<input type='hidden' class='hdOpeKeyId' value='" + opeKeyId + "' projectId='" + projectId + "' roleType='" + roleType + "'  />";
            if (data.isSuccess) {
                html += "<input type='hidden' class='designTableModel' value='" + JSON.stringify(data.rows) + "' isDesign='true' aesdesigntableinfo='" + aesdesigntableinfo + "' />";
            } else {
                html += "<input type='hidden' class='designTableModel' value='' isDesign='false' aesdesigntableinfo='" + aesdesigntableinfo + "' />";
            };
            html += "<input type='button' id='btnUpdate_check' value='修改' class='formBtn margt'/><input type='button' id='btnCancel_check' value='取消' class='clearBtn margl margt'/></li>";
            thisBox.empty().html(html);
            $.parser.parse(audit_options.tableElement); //重新渲染EasyUI
            if (data.isSuccess) {
                $.each(SetValueDesignTable(data.rows, JSON.parse(details)[0], "", true)['txt'], function (i, v) {
                    $("#" + i).textbox("setText", retrieveUnequa(v));
                });
            };
            if (data.isSuccess) {
                var richTextId = [];
                $.each(data.rows, function (i, v) {
                    if (v['类型'] == 0 || v['类型'] == 1) {
                        showWriteTextNumber.createNew("CheckDetail", "txt_" + v['ID'] + "_" + v['列名']);
                    };
                    if (v['类型'] == 6) {
                        richTextId.push("txt_" + v['ID'] + "_" + v['列名']);
                    }
                });
                if (richTextId.length > 0) {
                    initKindEditor(richTextId);         // 富文本编辑框初始化
                };
            } else {
                $("#txtAuditSuggest").textbox('setText', retrieveBr(details));
            };
            
            if (canUpload) {
                //创建上传实例
                audit_updateUploader = createWebuploader({
                    server: "../Handler/AuditHandler.ashx",
                    pick: {
                        id: "#webUploaderPickOfAudit",
                        innerHTML: "浏览",
                        multiple: false
                    },
                    txtFileName: "#txtFileNameOfAudit",
                    uploadTarget: "#divFileProgressContainerOfAudit",
                    successCallback: function (data) {
                        refreshTab2(getCurrentTab());//刷新当前页
                    }
                });
            };

            $(audit_options.tableElement).find("#btnUpdate_check").on("click", audit_update_submit);
            $(audit_options.tableElement).find("#btnCancel_check").on("click", audit_update_cancel);
        }).fail(function (err) {
            console.log(err);
        });
    };

    /**
     * 修改审核状态
     */
    var audit_recheck = function () {
        $('body').append('<div id="updateAuditState" class="easyui-dialog" style=" text-align:center;width:400px;height:200px; padding: 10px; word-wrap:break-word;" data-options="closed:true,modal:true"></div>');

        $('#updateAuditState').html("你确定要修改审核状态吗？").dialog({
            title: '提示',
            buttons: [{
                text: '确定', handler: function () {
                    var pdata = audit_options.submitData || {};
                    pdata["opeKeyId"] = $("#linkRecheck").attr('opeKeyId');
                    pdata["projectId"] = $("#linkRecheck").attr('projectId');
                    pdata["auditState"] = -1;
                    pdata["suggestion"] = "recheck"; //随意写的，没有具体作用
                    pdata["entrust"] = audit_options.entrust;
                    pdata["fileCount"] = 0;
                    pdata["recheck"] = 1;
                    pdata["resetLastAuditState"] = 0;

                    $.ajax({
                        url: audit_options.submitUrl,
                        type: "post",
                        data: pdata,
                        dataType: "json"
                    }).done(function (data) {
                        if (data.isSuccess) {
                            myMessage("修改成功", function () {
                                $("#updateAuditState").dialog("close");
                                $("#updateAuditState").remove();
                            
                                var tab = getCurrentTab();
                                //刷新前一个页面
                                reloadTable(getUrlParam("prevTitle"), 'list');
                                //刷新当前页
                                refreshTab2(tab);
                            });
                        } else {
                            myMessage(data.message);
                        };
                    }).fail(function (err) {
                        if (console && console.log) {
                            console.log(err);
                        }
                        myMessage("修改审核状态请求异常");
                    });
                }
            },
            {
                text: '取消', handler: function () {
                    $("#updateAuditState").dialog("close");
                    $("#updateAuditState").remove();
                }
            }]
        }).dialog("open").window('center');
    };

    /**
     * 修改最终审核状态
     */
    var audit_resetLastAuditState = function () {
        var currentRole = get_current_role();
        var thisBox = $(this).parent().parent().parent('.gxf_designTable_box');
        var aesdesigntableinfo = thisBox.find(".designTableModel").attr('aesdesigntableinfo'); // 是否自定义参数
        var details = thisBox.find(".designTableModel").val(); //详情
        var opeKeyId = thisBox.find(".hdOpeKeyId").val();
        var projectId = thisBox.find(".hdOpeKeyId").attr('projectId');
        var roleType = thisBox.find(".hdOpeKeyId").attr('roletype');
        var checkState = thisBox.find(".hdOpeKeyId").attr('checkState');
        var usuallyRetult = thisBox.find(".usuallyResultsDetails"); // 平时成绩
        var canUpload = false;
        var showAttachment = thisBox.find(".showAttachment").val();
        var attachmentHtml = "";
        if (showAttachment == 'true') {
            canUpload = true;
            attachmentHtml = '<li>';
            var fileName = thisBox.find(".showAttachment").attr('fileName');
            if (checkValIsUndefinedOrNull(fileName)) {
                attachmentHtml += '<p>添加附件：<span class="statement" id="audit_scfj" AttachmentNum = "0">新上传的文件将以附件的形式显示，支持附件格式为doc，docx，pdf，wps，rar，zip</span></p>';
            } else {
                attachmentHtml += '<p>添加附件：<span class="statement" id="audit_scfj" AttachmentNum = "0">已上传有关审核附件：<span style="color:#ff6632;">' + fileName + '<a href="javascript:co_audit.delAttachmentClick(\'' + fileName + '\');" class="listA margl">删除 </a></span>；'
                    + ' 新上传的文件将以附件的形式显示，支持附件格式为doc，docx，pdf，wps，rar，zip</span></p>';
            }
            attachmentHtml = attachmentHtml
                + '<input type="text" id="txtFileNameOfAudit" class="easyui-textbox" data-options="width:285,readonly:true" />'
                + '<span id="webUploaderPickOfAudit"></span>'
                + '<div id="divFileProgressContainerOfAudit" style=""></div>'
                + '</li>';
        }

        var html = '<li class="_checkState_">';
        html += '<p>审核状态</p>';
        html += '<div class="designTable_radio">';
        if (checkState == 1) {
            html += '<input id="rdoPass" class="margl" type="radio" name="rdoAudit" value="1" checked="checked"/><label for="rdoPass">通过</label>';
            html += '<input id="rdoUnPass" class="margl" type="radio" name="rdoAudit" value="-1"/><label for="rdoUnPass">' + getAuditStateText(-1, opeType).replace(/审核/g, '') + '</label>';
        } else if (checkState == -1) {
            html += '<input id="rdoPass" class="margl" type="radio" name="rdoAudit" value="1"/><label for="rdoPass">通过</label>';
            html += '<input id="rdoUnPass" class="margl" type="radio" name="rdoAudit" value="-1" checked="checked"/><label for="rdoUnPass">' + getAuditStateText(-1, opeType).replace(/审核/g, '') + '</label>';
        } else {
            html += '<input id="rdoPass" class="margl" type="radio" name="rdoAudit" value="1"/><label for="rdoPass">通过</label>';
            html += '<input id="rdoUnPass" class="margl" type="radio" name="rdoAudit" value="-1"/><label for="rdoUnPass">' + getAuditStateText(-1, opeType).replace(/审核/g, '') + '</label>';
        }
        
        html += '</div>';
        html += '</li>';
        if (currentRole == 3 && opeType == 3 && usuallyRetult.length > 0) {
            if (getUsuallyResultsIsShow() == 1) {
                var weightTxt = GetUsuallyResultsWeight(sid, projectId);
                html += '<li class="usuallyResults">';
                if (weightTxt && weightTxt.isSuccess && weightTxt.rows && weightTxt.rows.length > 0) {
                    html += '<p>' + (weightTxt.rows[0]["平时成绩名称"] || "单次平时成绩");
                    html += '<span class="statement margl" style="color: #000;">（该学生对应平时成绩占总成绩的权重为：<strong>' + weightTxt.rows[0]["平时成绩"] + '</strong>）</span></p>';
                } else {
                    html += '<p>单次平时成绩</p>';
                }
                html += '<input type="text" id="txtUsualGrade" class="easyui-textbox" data-options="width:80,height:30" />';
                var tipsTxt = GetUsuallyResultsTipsTxt();
                if (tipsTxt && tipsTxt.isSuccess && tipsTxt.dataList && tipsTxt.dataList.length > 0) {
                    html += '<span class="statement margl">' + tipsTxt.dataList[0]["提示"] + '</span>';
                }
                html += '<div class="statement txt_red">*仅选择“审核通过”时，可以在本次审核指导记录时，给定学生对应的“单次平时成绩”；系统将按照“多次平时成绩计算平均分”的方法计算学生的“平时成绩”，并按照设定的权重计入总成绩</div>'
                html += '</li>';
            }
        }


        $.ajax({
            url: "../Handler/DesignTableHandler.ashx",
            type: "post",
            data: {
                "action": "IshasSetDesignTableCommon",
                "designTableInfo": aesdesigntableinfo
            },
            dataType: "json"
        }).done(function (data) {
            if (data.isSuccess) {
                html += SetValueDesignTable(data.rows, JSON.parse(details)[0], "", true)['str'];
                if (showAttachment == 'true') {
                    html += attachmentHtml;
                };
            } else {
                html += '<li>';
                html += '<p>审核意见<span class="writerText margl"> 共输入<i style="color: #f00;"> ' + (details.replace(/\s|\r|\n/g, "").length) + ' </i>字符</span><span class="statement margl">请按照学校的要求，在下方输入相关内容，若无内容请填写“无”</span></p>';
                html += '<input id="txtAuditSuggest" type="text" class="easyui-textbox" data-options="multiline:true,height:100" style="width: 100%">';
                html += '</li>';
                if (showAttachment == 'true') {
                    html += attachmentHtml;
                };
            };

            html += "<li>";
            html += "<input type='hidden' class='hdOpeKeyId' value='" + opeKeyId + "' projectId='" + projectId + "' roleType='" + roleType + "' isUpdateLastState='1' />";
            if (data.isSuccess) {
                html += "<input type='hidden' class='designTableModel' value='" + JSON.stringify(data.rows) + "' isDesign='true' aesdesigntableinfo='" + aesdesigntableinfo + "' />";
            } else {
                html += "<input type='hidden' class='designTableModel' value='' isDesign='false' aesdesigntableinfo='" + aesdesigntableinfo + "' />";
            };
            html += "<input type='button' id='btnUpdate_LastAuditState' value='修改' class='formBtn margt'/><input type='button' id='btnCancel_check' value='取消' class='clearBtn margl margt'/></li>";
            thisBox.empty().html(html);
            $.parser.parse(audit_options.tableElement); //重新渲染EasyUI
            if (data.isSuccess) {
                $.each(SetValueDesignTable(data.rows, JSON.parse(details)[0], "", true)['txt'], function (i, v) {
                    $("#" + i).textbox("setText", retrieveUnequa(v));
                });
            };
            if (data.isSuccess) {
                var richTextId = [];
                $.each(data.rows, function (i, v) {
                    if (v['类型'] == 0 || v['类型'] == 1) {
                        showWriteTextNumber.createNew("CheckDetail", "txt_" + v['ID'] + "_" + v['列名']);
                    };
                    if (v['类型'] == 6) {
                        richTextId.push("txt_" + v['ID'] + "_" + v['列名']);
                    }
                });
                if (richTextId.length > 0) {
                    initKindEditor(richTextId);         // 富文本编辑框初始化
                };
            } else {
                $("#txtAuditSuggest").textbox('setText', retrieveBr(details));
            };

            if (usuallyRetult.length > 0) {
                var score = $(usuallyRetult.find(".gxf_designTable_detailes")).text();
                if(score >= 0){
                    $("#txtUsualGrade").textbox("setText", score);
                } else {
                    $("#txtUsualGrade").textbox("setText", "");
                }
            }


            if (canUpload) {
                //创建上传实例
                audit_resetLastAuditStateUploader = createWebuploader({
                    server: audit_options.submitUrl,
                    pick: {
                        id: "#webUploaderPickOfAudit",
                        innerHTML: "浏览",
                        multiple: false
                    },
                    txtFileName: "#txtFileNameOfAudit",
                    uploadTarget: "#divFileProgressContainerOfAudit",
                    successCallback: function (data) {
                        var tab = getCurrentTab();
                        //刷新前一个页面
                        reloadTable(getUrlParam("prevTitle"), 'list');
                        //刷新当前页
                        refreshTab2(tab);
                    }
                });
            };

            $(audit_options.tableElement).find("#btnUpdate_LastAuditState").on("click", audit_submit);
            $(audit_options.tableElement).find("#btnCancel_check").on("click", audit_update_cancel);
        }).fail(function (err) {
            console.log(err);
        });
    };
   
    /**
     * 历史记录查看详情
     * @param {any} historyId
     * @param {any} designTableInfo
     * @param {any} roleName
     */
    audit.auditHistoryDtetails = function (historyId, designTableInfo, roleName) {
        $('body').append('<div id="historyDetailsView" class="easyui-dialog" style="width:80%;height:500px; padding: 5px;" data-options="closed:true,modal:true"></div>');
        $.ajax({
            url: "../Handler/AuditHandler.ashx",
            type: "post",
            dataType: "json",
            data: {
                'action': "GetAuditLogDetail",
                'historyId': historyId,
                'designTableInfo': designTableInfo
            }
        }).done(function (data) {
            if (data.isSuccess) {
                var html = '';
                html += '<div class="gxf_designTable_content">';
                html += '<ul class="gxf_designTable_box">';
                html += '<li  class="gxf_designTable_roleTime">';
                html += '<span >审核人：' + (roleName || " ") + '</span><span class="margl">审核时间：' + (data.dataList['AuditTime'] || " ") + '</span>';
                html += '</li>';
                html += '<li  class="_checkState_"><p>审核状态</p>';
                html += '<div class="gxf_designTable_detailes"><span class="' + getAuditCss(data.dataList['State']) + '">' + getAuditStateText(data.dataList['State'], data.dataList['OpeType']) + '</span>';
                html += '</div></li>';
                if (data.dataList['IsDesign']) {
                    html += GetDetailesDesignTable(data.dataList['DesignTableModel'], data.dataList['DesignTableData'][0], "", true);
                } else {
                    html += '<li><p>审核意见</p><div class="gxf_designTable_detailes">' + replaceBr(data.dataList['Suggestion']) + '</div></li>';
                };
                if (data.dataList['ShowAttachment']) {
                    if (!checkValIsUndefinedOrNull(data.dataList['Attachment']) && !checkValIsUndefinedOrNull(data.dataList['AttachmentUrl'])) {
                        html += '<li>';
                        html += '<p>附件</p><div class="gxf_designTable_detailes">' + data.dataList['Attachment'] + '<a class="listA margl" href="' + data.dataList['AttachmentUrl'] + '" download="' + data.dataList['Attachment'] + '" title="' + data.dataList['Attachment'] + '">点击下载</a></div>';
                        html += '</li>';
                    };
                };
                html += '</ul></div>';
                $('#historyDetailsView').html(html);
                $('#historyDetailsView').dialog({
                    title: '审核历史记录',
                    buttons: [{
                        text: '确定', handler: function () {
                            $("#historyDetailsView").dialog("close");
                            $("#historyDetailsView").remove();
                        }
                    }]
                });
                $("#historyDetailsView").dialog("open").window('center');
            };
        }).fail(function (err) {
            console.log(err);
        });
    };

    /**
     * 解析审核信息
     * @param {any} auditDetail
     */
    var audit_parse = function (auditDetail) {
        var html = "";
        var currentRole = get_current_role();
        var entrust = audit_options.entrust;
        if (currentRole == 3 || currentRole == 10) { //指导教师
            if (!checkValIsUndefinedOrNull(entrust)) { //委托审核，用委托人的角色
                currentRole = entrust;
            }
        } else if (currentRole == 1) { //管理员
            currentRole = 1000;
        }

        var canUpload = false; //是否可以上传附件
        if (auditDetail && auditDetail.OperationLogs && auditDetail.OperationLogs.length > 0) {
            opeType = auditDetail.OperationLogs[0].OpeType;
            for (var i = 0; i < auditDetail.OperationLogs.length; i++) {
                var operationLog = auditDetail.OperationLogs[i];
                var opeKeyId = operationLog.Id;
                var state = operationLog.State;
                var projectId = operationLog.ProjectId;
                var auditTime = operationLog.AuditTime || "          ";
                var auditSuggest = (operationLog.Suggestion);
                var auditor = operationLog.AuditorName || "      ";
                var roleType = operationLog.RoleType;
                var roleName = operationLog.RoleName;
                var auditCss = getAuditCss(state);
                var auditText = getAuditStateText(state, opeType);
                var isDesign = operationLog.IsDesign;// 是否自定义
                var designTableModel = operationLog.DesignTableModel;
                var designTableData = operationLog.DesignTableData;
                var showAttachment = operationLog.ShowAttachment; // 是否显示附件
                var aesDesignTableInfo = operationLog.AesDesignTableInfo; // 自定义修改时参数
                var UsuallyResult = operationLog.PeaceTimeScore; // 平时成绩
                if (checkValIsUndefinedOrNull(roleName)) { //系统自动审核，不显示审核人
                    auditor = "      ";
                    auditTime = "          ";
                }

                //附件
                var fileName = operationLog.Attachment || "";
                var fileLink = operationLog.AttachmentUrl || "";

                //历史记录
                var historyHtml = "";
                if (operationLog.HistoryLogs && operationLog.HistoryLogs.length > 0) {
                    historyHtml += "<li class='gxf_designTable_history'>";
                    var HisLength = operationLog.HistoryLogs.length;
                    for (var h = 0; h < operationLog.HistoryLogs.length; h++) {
                        var historyLog = operationLog.HistoryLogs[h];
                        historyHtml += "<div>" + historyLog['HistoryTime'] + "<span class='margl'> 第 " + (HisLength) + " 次审核意见</span><a class='listA margl' href='javascript:co_audit.auditHistoryDtetails(" + historyLog['Id'] + ',\"' + aesDesignTableInfo + "\",\"" + auditor + "\");'>查看详情</a></div>";
                        HisLength--;
                    };
                    historyHtml += "</li>";
                };
                html = "";

                var canRecheck = operationLog.CanRecheck || false; //是否可以修改审核状态
                var canResetLastAuditState = operationLog.CanResetLastAuditState || false; //是否可以修改最终审核状态
                
                if (state == 1) { //审核通过
                    html += '<div class="gxf_designTable_check">' + roleName + '审核情况</div>';
                    html += '<div class="gxf_designTable_content">';
                    html += '<ul class="gxf_designTable_box">';
                    html += '<li  class="gxf_designTable_roleTime">';
                    html += '<span >审核人：' + auditor + '</span><span class="margl">审核时间：' + auditTime + '</span>';
                    if (auditDetail.CurrentTid > 0 && auditDetail.CurrentTid == operationLog.Auditor && currentRole > 0 && currentRole == roleType) { //审核通过，可以修改审核意见
                        if (canRecheck) {
                            html += "<span><a id='linkRecheck' class='listA margl' projectId='" + projectId + "' opeKeyId='" + opeKeyId + "' href='javascript:void(0);'>修改审核状态</a></span>";
                        };
                        
                        if (canResetLastAuditState) {
                            html += "<span><a id='linkResetLastAuditState' class='listA margl' projectId='" + projectId + "' opeKeyId='" + opeKeyId + "' auditState='" + state + "' href='javascript:void(0);'>修改最终审核状态</a></span>";
                            html += "<span class='statement mgL txt_red'>（上一次提交后30分钟内，您可以修改审核状态）</span>";
                        } else {
                            html += "<span><a id='linkUpdateAuditLog' class='listA margl' projectId='" + projectId + "' opeKeyId='" + opeKeyId + "' href='javascript:void(0);'>修改审核内容</a></span>";
                        };
                    };
                    html += '</li>';
                    html += '<li  class="_checkState_"><p>审核状态</p>';
                    html += "<input type='hidden' class='hdOpeKeyId' value='" + opeKeyId + "' projectId='" + projectId + "' roleType='" + roleType + "' checkState='1'/>";
                    html += "<input type='hidden' class='showAttachment' value='" + showAttachment + "' fileName='" + fileName + "' fileLink='" + fileLink + "' />";
                    html += "<input type='hidden' class='designTableModel' value='" + (checkValIsUndefinedOrNull(designTableData) ? replaceBr(auditSuggest) : replaceUnequa(JSON.stringify(designTableData))) + "' aesDesignTableInfo='" + aesDesignTableInfo + "' />";
                    html += '<div class="gxf_designTable_detailes"><span class="' + auditCss + '">' + auditText + '</span>';
                    html += '</div></li>';
                    // 平时成绩
                    if (currentRole == 3 && opeType == 3) {
                        if (getUsuallyResultsIsShow() == 1) {
                            var weightTxt = GetUsuallyResultsWeight(sid, projectId);
                            html += '<li  class="usuallyResultsDetails">';
                            if (weightTxt && weightTxt.isSuccess && weightTxt.rows && weightTxt.rows.length > 0) {
                                html += '<p>' + (weightTxt.rows[0]["平时成绩名称"] || "单次平时成绩");
                                html += '<span class="statement margl" style="color: #000;">（该学生对应平时成绩占总成绩的权重为：<strong>' + (weightTxt.rows[0]["平时成绩"] || 0) + '</strong>）</span></p>';
                            } else {
                                html += '<p>单次平时成绩</p>';
                            }
                            html += '<div class="gxf_designTable_detailes">' + (UsuallyResult || " ") + '</div></li>';
                        }
                    }
                    if (isDesign) {
                        html += GetDetailesDesignTable(designTableModel, designTableData[0], "", true);
                    } else {
                        html += '<li><p>审核意见</p><div class="gxf_designTable_detailes">' + replaceBr(auditSuggest) + '</div></li>';
                    };
                    if (showAttachment) {
                        if (!checkValIsUndefinedOrNull(fileName) && !checkValIsUndefinedOrNull(fileLink)) {
                            html += '<li>';
                            html += '<p>附件</p><div class="gxf_designTable_detailes">' + fileName + '<a class="listA margl" href="' + fileLink + '" download="' + fileName + '" title="' + fileName + '">点击下载</a></div>';
                            html += '</li>';
                        };
                    };
                    html += historyHtml;
                    html += '</ul></div>';
                } else if (state == -1) { //审核不通过
                    html += '<div class="gxf_designTable_check">' + roleName + '审核情况</div>';
                    html += '<div class="gxf_designTable_content">';
                    html += '<ul class="gxf_designTable_box">';
                    html += '<li  class="gxf_designTable_roleTime">';
                    html += '<span >审核人：' + auditor + '</span><span class="margl">审核时间：' + auditTime + '</span>';
                    if (auditDetail.CurrentTid > 0 && auditDetail.CurrentTid == operationLog.Auditor && currentRole > 0 && currentRole == roleType) { 
                        if (canResetLastAuditState) {
                            html += "<span><a id='linkResetLastAuditState' class='listA margl' projectId='" + projectId + "' opeKeyId='" + opeKeyId + "' auditState='" + state + "' href='javascript:void(0);'>修改最终审核状态</a></span>";
                            html += "<span class='statement mgL txt_red'>（上一次提交后30分钟内，您可以修改审核状态）</span>";
                        } else {
                            html += "<span><a id='linkUpdateAuditLog' class='listA margl' projectId='" + projectId + "' opeKeyId='" + opeKeyId + "' href='javascript:void(0);'>修改审核内容</a></span>";
                        };
                    };
                    html += '</li>';
                    html += '<li  class="_checkState_"><p>审核状态</p>';
                    html += "<input type='hidden' class='hdOpeKeyId' value='" + opeKeyId + "' projectId='" + projectId + "' roleType='" + roleType + "' checkState='-1' />";
                    html += "<input type='hidden' class='showAttachment' value='" + showAttachment + "' fileName='" + fileName + "' fileLink='" + fileLink + "' />";
                    html += "<input type='hidden' class='designTableModel' value='" + (checkValIsUndefinedOrNull(designTableData) ? replaceBr(auditSuggest) : replaceUnequa(JSON.stringify(designTableData))) + "' aesDesignTableInfo='" + aesDesignTableInfo + "' />";
                    html += '<div class="gxf_designTable_detailes"><span class="' + auditCss + '">' + auditText + '</span></div></li>';
                    // 平时成绩
                    if (currentRole == 3 && opeType == 3) {
                        if (getUsuallyResultsIsShow() == 1) {
                            var weightTxt = GetUsuallyResultsWeight(sid, projectId);
                            html += '<li  class="usuallyResultsDetails">';
                            if (weightTxt && weightTxt.isSuccess && weightTxt.rows && weightTxt.rows.length > 0) {
                                html += '<p>' + (weightTxt.rows[0]["平时成绩名称"] || "单次平时成绩");
                                html += '<span class="statement margl" style="color: #000;">（该学生对应平时成绩占总成绩的权重为：<strong>' + (weightTxt.rows[0]["平时成绩"] || 0) + '</strong>）</span></p>';
                            } else {
                                html += '<p>单次平时成绩</p>';
                            }
                            html += '<div class="gxf_designTable_detailes">' + (UsuallyResult || " ") + '</div></li>';
                        }
                    }
                    if (isDesign) {
                        html += GetDetailesDesignTable(designTableModel, designTableData[0], "", true);
                    } else {
                        html += '<li><p>审核意见</p><div class="gxf_designTable_detailes">' + replaceBr(auditSuggest) + '</div></li>';
                    };
                    if (showAttachment) {
                        if (!checkValIsUndefinedOrNull(fileName) && !checkValIsUndefinedOrNull(fileLink)) {
                            html += '<li>';
                            html += '<p>附件</p><div class="gxf_designTable_detailes">' + fileName + '<a class="listA margl" href="' + fileLink + '" download="' + fileName + '" title="' + fileName + '">点击下载</a></div>';
                            html += '</li>';
                        };
                    };
                    html += historyHtml;
                    html += '</ul></div>';
                } else if (state == 0) { //等待审核
                    if (currentRole != roleType) {
                        html += '<div class="gxf_designTable_check">' + roleName + '审核情况</div>';
                        html += '<div class="gxf_designTable_content">';
                        html += '<ul class="gxf_designTable_box">';
                        html += '<li  class="_checkState_"><p>审核状态</p>';
                        html += '<div class="gxf_designTable_detailes"><span class="' + auditCss + '">' + auditText + '</span></div></li>';
                        // 平时成绩
                        if (currentRole == 3 && opeType == 3) {
                            if (getUsuallyResultsIsShow() == 1) {
                                var weightTxt = GetUsuallyResultsWeight(sid, projectId);
                                html += '<li  class="usuallyResultsDetails">';
                                if (weightTxt && weightTxt.isSuccess && weightTxt.rows && weightTxt.rows.length > 0) {
                                    html += '<p>' + (weightTxt.rows[0]["平时成绩名称"] || "单次平时成绩");
                                    html += '<span class="statement margl" style="color: #000;">（该学生对应平时成绩占总成绩的权重为：<strong>' + (weightTxt.rows[0]["平时成绩"] || 0) + '</strong>）</span></p>';
                                } else {
                                    html += '<p>单次平时成绩</p>';
                                }
                                html += '<div class="gxf_designTable_detailes">等待录入</div></li>';
                            }
                        }
                        //if (isDesign) {
                        //    html += GetDetailesDesignTable(designTableModel, designTableData[0], "", true);
                        //} else {
                        //    html += '<li><p>审核意见</p><div class="gxf_designTable_detailes"> &nbsp;</div></li>';
                        //};
                        //html += '<li><p>审核人</p><div class="gxf_designTable_detailes">--</div></li>';
                        //html += '<li><p>审核时间</p><div class="gxf_designTable_detailes">--</div></li>';
                        html += '</ul></div>';
                    } else if (currentRole != 0) {
                        html += '<div class="gxf_designTable_check">' + roleName + '审核情况</div>';
                        html += '<div class="gxf_designTable_content">';
                        html += '<ul  class="gxf_designTable_box">';;
                        html += '<li class="_checkState_">';
                        html += '<p>审核状态</p>';
                        html += '<div class="designTable_radio">';
                        html += '<input id="rdoPass" class="margl" type="radio" name="rdoAudit" value="1" /><label for="rdoPass">通过</label>';
                        html += '<input id="rdoUnPass" class="margl" type="radio" name="rdoAudit" value="-1" /><label for="rdoUnPass">' + getAuditStateText(-1, opeType).replace(/审核/g, '') + '</label>';
                        html += '</div>';
                        html += '</li>';
                        if (currentRole == 3 && opeType == 3) {
                            if (getUsuallyResultsIsShow() == 1) {
                                var weightTxt = GetUsuallyResultsWeight(sid, projectId);
                                html += '<li class="usuallyResults">';
                                if (weightTxt && weightTxt.isSuccess && weightTxt.rows && weightTxt.rows.length > 0) {
                                    html += '<p>' + (weightTxt.rows[0]["平时成绩名称"] || "单次平时成绩");
                                    html += '<span class="statement margl" style="color: #000;">（该学生对应平时成绩占总成绩的权重为：<strong>' + weightTxt.rows[0]["平时成绩"] + '</strong>）</span></p>';
                                } else {
                                    html += '<p>单次平时成绩</p>';
                                }
                                html += '<input type="text" id="txtUsualGrade" class="easyui-textbox" data-options="width:80,height:30" />';
                                var tipsTxt = GetUsuallyResultsTipsTxt();
                                if (tipsTxt && tipsTxt.isSuccess && tipsTxt.dataList && tipsTxt.dataList.length > 0) {
                                    html += '<span class="statement margl">' + tipsTxt.dataList[0]["提示"] + '</span>';
                                }
                                html += '<div class="statement txt_red">*仅选择“审核通过”时，可以在本次审核指导记录时，给定学生对应的“单次平时成绩”；系统将按照“多次平时成绩计算平均分”的方法计算学生的“平时成绩”，并按照设定的权重计入总成绩</div>'
                                html += '</li>';
                            }
                        }
                        
                        if (isDesign) {
                            html += SetDesignTable(designTableModel, "", true);
                            if (showAttachment) {
                                canUpload = true;
                                html += '<li>';
                                html += '<p>添加附件：<span class="statement" id="scfj">上传有关审核的附件，上传的文件将以附件的形式显示。支持附件格式为doc，docx，pdf，wps，rar，zip</span></p>';
                                html += '<input type="text" id="txtFileNameOfAudit" class="easyui-textbox" data-options="width:285,readonly:true" />';
                                html += '<span id="webUploaderPickOfAudit"></span>';
                                html += '<div id="divFileProgressContainerOfAudit"></div>';
                                html += '</li>';
                            };
                        } else {
                            html += '<li>';
                            html += '<p>审核意见<span class="writerText margl"> 共输入<i style="color: #f00;"> 0 </i>字符</span><span class="statement margl">请按照学校的要求，在下方输入相关内容，若无内容请填写“无”</span></p>';
                            html += '<input id="txtAuditSuggest" type="text" class="easyui-textbox" data-options="multiline:true,height:100" style="width: 100%">';
                            html += '</li>';
                            canUpload = true;
                            html += '<li>';
                            html += '<p>添加附件：<span class="statement" id="scfj">上传有关审核的附件，上传的文件将以附件的形式显示。支持附件格式为doc，docx，pdf，wps，rar，zip</span></p>';
                            html += '<input type="text" id="txtFileNameOfAudit" class="easyui-textbox" data-options="width:285,readonly:true" />';
                            html += '<span id="webUploaderPickOfAudit"></span>';
                            html += '<div id="divFileProgressContainerOfAudit"></div>';
                            html += '</li>';
                        };
                        html += "<li>";
                        html += "<input type='hidden' class='hdOpeKeyId' value='" + opeKeyId + "' projectId='" + projectId + "' roleType='" + roleType + "'   />";
                        html += "<input type='hidden' class='designTableModel' value='" + JSON.stringify(designTableModel) + "' isDesign='" + isDesign + "' />";
                        html += "<input type='button' id='btnSubmit' value='提交' class='formBtn margt'/></li>";
                        html += '</ul></div>';
                    };
                };
                $(audit_options.tableElement).append(html);
                $.parser.parse(audit_options.tableElement); //重新渲染EasyUI
                if (isDesign && state == 0) {
                    var richTextId = [];
                    $.each(designTableModel, function (i, v) {
                        if (v['类型'] == 0 || v['类型'] == 1) {
                            showWriteTextNumber.createNew("CheckDetail", "txt_" + v['ID'] + "_" + v['列名']);
                        };
                        if (v['类型'] == 6) {
                            richTextId.push("txt_" + v['ID'] + "_" + v['列名']);
                        }
                    });
                    if (richTextId.length > 0) {
                        initKindEditor(richTextId);         // 富文本编辑框初始化
                    };
                } else {
                    showWriteTextNumber.createNew("CheckDetail", "txtAuditSuggest");
                };
            };
            $(audit_options.tableElement).find("#btnSubmit").on('click', audit_submit);
            $(audit_options.tableElement).find("#linkUpdateAuditLog").on("click", audit_update);
            $(audit_options.tableElement).find("#linkRecheck").on("click", audit_recheck);
            $(audit_options.tableElement).find("#linkResetLastAuditState").on("click", audit_resetLastAuditState);
            $(audit_options.tableElement).find("input[name=rdoAudit]").on("click", isUsuallyResultsShow);
        };

        if (canUpload) {
            //fileQueued_Audit
            //创建上传实例
            audit_submitUploader = createWebuploader({
                server: audit_options.submitUrl,
                pick: {
                    id: "#webUploaderPickOfAudit",
                    innerHTML: "浏览",
                    multiple: false
                },
                txtFileName: "#txtFileNameOfAudit",
                uploadTarget: "#divFileProgressContainerOfAudit",
                successCallback: function (data) {
                    var tabTitle = getCurrentTabTitle(); //当前tabTitle
                    reloadTable(getUrlParam("prevTitle"), 'list');//刷新前一个页面
                    closeTab(tabTitle);//关闭当前页
                }
            });
        }
    };

    // 平时成绩是否可以录入
    var isUsuallyResultsShow = function () {
        var $this = $(this);
        var $usuallyResultsHtml = $this.parent().parent().siblings(".usuallyResults");
        if ($usuallyResultsHtml.length > 0) {
            if ($this.attr("id") == 'rdoPass') {
                $('#txtUsualGrade').textbox({ 'disabled': false });
            } else if ($this.attr("id") == 'rdoUnPass') {
                $('#txtUsualGrade').textbox({ 'disabled': true });
            }
        }
    };
    /**
     * 查询审核信息
     */
    var audit_query = function() {
        var projectId = audit_options.projectId;
        $.ajax({
            url: audit_options.queryUrl,
            type: "post",
            data: audit_options.queryParams,
            dataType: "json",
            success: function(data) {
                if (data) {
                    if (data.isSuccess) {
                        audit_parse(data.dataList);
                        if (detail_callback) {
                            detail_callback.call(this, data);
                        };
                    } else {
                        myMessage(data.message);
                    };
                };
            },
            error: function(err) {
                if (console && console.log) {
                    console.log(err.statusText);
                };
            }
        });
    };
    
    /**
     * 绑定
     * @param {} options 参数集合
     * @param {callback} auditCallback 审核成功后回调函数
     * @param {callback} detailCallback 获取详情后回调函数
     * @returns {} 
     */
    audit.bind = function (options, auditCallback, detailCallback) {
        audit_options = options || {};
        audit_callback = auditCallback;
        detail_callback = detailCallback;
        opeType = -1;
        audit_submitUploader = null;
        audit_updateUploader = null;
        audit_resetLastAuditStateUploader = null;
        audit_query();
    }

})(co_audit || (co_audit = {}));


//获取平时成绩评分权重
function GetUsuallyResultsWeight(sid,projectId) {
    var params;
    $.ajax({
        url: "../Handler/ReviewHandler.ashx",
        type: "post",
        dataType: "json",
        data: {
            "action": "GetStudentScoringWeight",
            "sid": sid,
            "projectId": projectId
        },
        async: false,
        success: function (data) {
            params = data;
        },
        error: function (err) {
            console.log(err);
        }
    });
    return params;
};

// 获取平时成绩提示
function GetUsuallyResultsTipsTxt() {
    var params;
    $.ajax({
        url: "../Handler/ReviewHandler.ashx",
        type: "post",
        dataType: "json",
        data: {
            "action": "GetGetScoreRankToolTipsText"
        },
        async: false,
        success: function (data) {
            params = data;
        },
        error: function (err) {
            console.log(err);
        }
    });
    return params;
};

// 获取平时成绩是否显示
function getUsuallyResultsIsShow() {
    var params = 0;
    $.ajax({
        url: "../Handler/ReviewHandler.ashx",
        type: "post",
        dataType: "json",
        data: {
            "action": "GetReviewColumn"
        },
        async: false,
        success: function (data) {
            if (data.isSuccess && data.dataList && data.dataList.length > 0) {
                params = data.dataList[0]["不显示平时成绩"];
            }
        },
        error: function (err) {
            console.log(err);
        }
    });
    return params;
};