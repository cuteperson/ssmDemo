/*
    * 是否设置自定义
    * type   自定义type
    * xybh  学院编号
    * zybh  转业编号
*/
function isSetDesignTable(type, xybh, zybh) {
    var xhr = $.ajax({
        url: "../Handler/DesignTableHandler.ashx",
        data: {
            "action": "IshasSetDesignTableCommon",
            "type": type,
            "xybh": xybh,
            "zybh": zybh
        },
        dataType: "json",
        type: "POST"
    });
    return xhr;
};
/*
    * 是否设置自定义 ,区分角色
    * type   自定义type
    * xybh  课题学院编号
    * zybh  课题专业编号
    * rolnum 角色
*/
function IshasSetDesignTableCommonRoleType(type, xybh, zybh, rolnum) {
    var xhr = $.ajax({
        url: "../Handler/DesignTableHandler.ashx",
        data: {
            "action": "IshasSetDesignTableCommonRoleType",
            "type": type,
            "xybh": xybh,
            "zybh": zybh,
            "rolnum": rolnum
        },
        dataType: "json",
        type: "POST"
    });
    return xhr;
};

/*
    * 自定义表初次提交
    * data   自定义表
    * htmlID  页面ul的id
    * checType  是否直接返回html字符串（审核用）
*/
function SetDesignTable(data, htmlID, checType) {
    if (data) {
        var richTextId = [];// 富文本ID
        var newStr = "";
        $.each(data, function (i, v) {
            var leixing = v["类型"];
            var zhushi = (v["注释"] || "");
            var TMleixing = v["标题类型"];
            if (TMleixing == 0) {
                if (leixing == "0") {// 文本
                    var txt = v['限制'];
                    var idName = 'txt_' + v["ID"] + '_' + v["列名"]
                    if (txt == "" || txt == null) {//文本默认  
                        newStr += '<li>'
                            + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="writerText margl"> 共输入<i style="color: #f00;"> 0 </i>字符</span><span class="statement margl">' + zhushi + '</span></p>'
                            + '<input id="' + idName + '" type="text" class="easyui-textbox" data-options="multiline:true,height:100" style="width:100%">'
                            + '</li>';
                    } else {
                        txt = txt.split("-")[1];
                        if (txt <= 80) { // 文本小
                            newStr += '<li>'
                                + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="writerText margl"> 共输入<i style="color: #f00;"> 0 </i>字符</span><span class="statement margl">' + zhushi + '</span></p>'
                                + '<input id="' + idName + '" type="text" class="easyui-textbox" data-options="multiline:true,height:30" style="width:100%"/>'
                                + '</li>';
                        } else { // 文本大
                            newStr += '<li>'
                                + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="writerText margl"> 共输入<i style="color: #f00;"> 0 </i>字符</span><span class="statement margl">' + zhushi + '</span></p>'
                                + '<input id="' + idName + '" type="text" class="easyui-textbox" data-options="multiline:true,height:100" style="width:100%">'
                                + '</li>';
                        };
                    };
                };
                if (leixing == "1") {//数字
                    var idName = 'txt_' + v["ID"] + '_' + v["列名"];
                    newStr += '<li>'
                        + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="writerText margl"> 共输入<i style="color: #f00;"> 0 </i>字符</span><span class="statement margl">' + zhushi + '</span></p>'
                        + '<input id="' + idName + '" type="text" class="easyui-textbox" data-options="height:30" style="width:100%"/>'
                        + '</li>';
                };
                if (leixing == "2") {//单选
                    var idName = 'radio_' + v["ID"] + '_' + v["列名"];
                    newStr += '<li>'
                        + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></p>'
                        + '<div class="designTable_radio">';
                    if (v["中文列名"] !== "") {
                        var raido = v["中文列名"].split(",");
                        for (var i = 0; i < raido.length; i++) {
                            if (v["默认项"] && v["默认项"].indexOf(raido[i]) >= 0) {
                                newStr += '<input class="margl" type="radio" id="' + idName + i + '" name="' + idName + '" value="' + i + '" checked ="checked"  />' + '<label for="' + idName + i + '">' + raido[i] + '</label>';
                            } else {
                                newStr += '<input class="margl" type="radio" id="' + idName + i + '" name="' + idName + '" value="' + i + '" />' + '<label for="' + idName + i + '">' + raido[i] + '</label>';
                            };
                        };;
                    };
                    newStr += '</div></li>';
                };
                if (leixing == "3") {//多选
                    var idName = '';
                    newStr += '<li>'
                        + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></p>'
                        + '<div class="designTable_radio">';
                    if (v["中文列名"] !== "") {
                        var raido = v["中文列名"].split(",");
                        var id = v["列名"].split(",")
                        for (var i = 0; i < raido.length; i++) {
                            idName = 'checkbox_' + v["ID"] + '_' + id[i];
                            if (v["默认项"] && v["默认项"].indexOf(raido[i]) >= 0) {
                                newStr += '<input class="margl" type="checkbox" id="' + idName + '" value="' + i + '" checked="checked"/>' + '<label for="' + idName + '">' + raido[i] + '</label>';
                            } else {
                                newStr += '<input class="margl" type="checkbox" id="' + idName + '" value="' + i + '" />' + '<label for="' + idName + '">' + raido[i] + '</label>';
                            };
                        };
                    };
                    newStr += '</div></li>';
                };
                if (leixing == "4") {//时间
                    var idName = 'txt_' + v["ID"] + '_' + v["列名"];
                    //newStr += '<li>'
                    //            + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></p>'
                    //            + '<input id="' + v["列名"] + v["ID"] + '" type="text" class="easyui-textbox" data-options="multiline:true,height:30" />'
                    //            + '</li>';
                };
                if (leixing == "6") {//富文本
                    var idName = 'txt_' + v["ID"] + '_' + v["列名"];
                    richTextId.push(idName);
                    newStr += '<li>'
                        + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="writerText margl"> 共输入<i style="color: #f00;"> 0 </i>字符</span><span class="statement margl">' + zhushi + '</span></p>'
                        + '<textarea class="ad-txt" id="' + idName + '" name="' + idName + '" style="width: 100%; height: 500px;"></textarea>'
                        + '</li>';
                };
                if (leixing == 7) {//只显示标题 不显示内容
                    newStr += '<li><p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></p></li>';
                };
            } else if (TMleixing == 1) { //二级自定义标题
                if (leixing == "0") {//文本
                    var name = "txt_" + v['ID'] + "_" + v['列名'];
                    var txtLen = v['限制'];
                    if (txtLen == "" || txtLen == null) {
                        newStr += '<li><div class="gxf_designTable_secondTitle">'
                            + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + ' <span class="writerText margl"> 共输入<i style="color: #f00;"> 0 </i>字符</span><span class="statement margl">' + zhushi + '</span></h3>'
                            + '<input id="txt_' + v['ID'] + '_' + v['列名'] + '" type="text" class="easyui-textbox" data-options="multiline:true,height:100" style="width:100%">'
                            + '</div></li>';
                    } else {
                        txtLen = txtLen.split("-");
                        if (txtLen[1] <= 80) {// 文本长度小于80
                            newStr += '<li><div class="gxf_designTable_secondTitle">'
                                + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + ' <span class="writerText margl"> 共输入<i style="color: #f00;"> 0 </i>字符</span><span class="statement margl">' + zhushi + '</span></h3>'
                                + '<input id="txt_' + v['ID'] + '_' + v['列名'] + '" type="text" class="easyui-textbox" data-options="multiline:true,height:30" style="width:100%">'
                                + '</div></li>';
                        } else {// 文本长度大于
                            newStr += '<li><div class="gxf_designTable_secondTitle">'
                                + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + ' <span class="writerText margl"> 共输入<i style="color: #f00;"> 0 </i>字符</span><span class="statement margl">' + zhushi + '</span></h3>'
                                + '<input id="txt_' + v['ID'] + '_' + v['列名'] + '" type="text" class="easyui-textbox" data-options="multiline:true,height:100" style="width:100%">'
                                + '</div></li>';
                        };
                    };
                };
                if (leixing == "1") {//数字
                    var name = "txt_" + v['ID'] + "_" + v['列名'];
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="writerText margl"> 共输入<i style="color: #f00;"> 0 </i>字符</span><span class="statement margl">' + zhushi + '</span></h3>'
                        + '<input id="txt_' + v['ID'] + '_' + v['列名'] + '" type="text" class="easyui-textbox" data-options="multiline:true,height:30" style="width:100%">'
                        + '</div></li>';
                };
                if (leixing == "2") {//单选
                    var idName = 'radio_' + v["ID"] + '_' + v["列名"];
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></h3>'
                        + '<div class="designTable_radio">';
                    if (v["中文列名"] !== "") {
                        var raido = v["中文列名"].split(",");
                        for (var i = 0; i < raido.length; i++) {
                            if (v["默认项"] && v["默认项"].indexOf(raido[i]) >= 0) {
                                newStr += '<input class="margl" type="radio" id="' + idName + i + '" name="' + idName + '" value="' + i + '"  checked="checked"/>' + ' <label class="margr" for="' + idName + i + '">' + raido[i] + '</label>';
                            } else {
                                newStr += '<input class="margl" type="radio" id="' + idName + i + '" name="' + idName + '" value="' + i + '" />' + ' <label class="margr" for="' + idName + i + '">' + raido[i] + '</label>';
                            };
                        };
                    };
                    newStr += '</div></li>';
                };
                if (leixing == "3") {//多选
                    var idName = '';
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></h3>'
                        + '<div class="designTable_radio">';
                    if (v["中文列名"] !== "") {
                        var raido = v["中文列名"].split(",");
                        var id = v["列名"].split(",")
                        for (var i = 0; i < raido.length; i++) {
                            idName = 'checkbox_' + v["ID"] + '_' + id[i];
                            if (v["默认项"] && v["默认项"].indexOf(raido[i]) >= 0) {
                                newStr += '<input class="margl" type="checkbox" id="' + idName + '" value="' + i + '" checked = "checked"/>' + ' <label class="margr"  for="' + idName + '">' + raido[i] + '</label>';
                            } else {
                                newStr += '<input class="margl" type="checkbox" id="' + idName + '" value="' + i + '" />' + ' <label class="margr"  for="' + idName + '">' + raido[i] + '</label>';
                            };
                        };
                    };
                    newStr += '</div></li>';
                };
                if (leixing == "4") {//时间
                    var name = "txt_" + v['ID'] + "_" + v['列名'];
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></h3>'
                        + '<div style="width:958px; background:#fff;border:1px solid #ddd; padding:8px 10px;">'
                        + '<input id="' + name + '" class="easyui-datetimebox" data-options="showSeconds:false,editable: false,height:26,width:180" panelheight="260" />'
                        //+ '<span>至</span>'
                        //+ '<input id="TimeEnd" class="easyui-datetimebox" data-options="showSeconds:false,editable: false,height:26,width:180" panelheight="260" />'
                        + '</div></li>';
                };
                if (leixing == "6") {//富文本
                    var name = "txt_" + v['ID'] + "_" + v['列名'];
                    richTextId.push(name);
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + ' <span class="writerText margl"> 共输入<i style="color: #f00;"> 0 </i>字符</span><span class="statement margl">' + zhushi + '</span></h3>'
                        + '<textarea class="ad-txt" id="' + name + '" name="' + name + '" style="width: 100%; height: 500px;"></textarea>'
                        + '</div></li>';
                };
                if (leixing == 7) {//只显示标题 不显示内容
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + ' <span class="statement margl">' + zhushi + '</span></h3>'
                        + '</div></li>';
                };
            };
        });
        if (checType) {
            return newStr;
        } else {
            $("#" + htmlID).append(newStr);    //添加到页面
            $.parser.parse('#' + htmlID);       // 重新渲染EasyUI
            if (richTextId.length > 0) {
                initKindEditor(richTextId);         // 富文本编辑框初始化
            };
            $.each(data, function (i, v) {
                if (v['类型'] == 0 || v['类型'] == 1) {
                    showWriteTextNumber.createNew(htmlID, "txt_" + v['ID'] + "_" + v['列名']);
                };
            });
        };
    };
};

/*
    * 自定义表修改时
    * data   自定义表
    * value  提交的数据
    * htmlID  页面ul的id
    * checType  是否直接返回html字符串（审核用）
*/
function SetValueDesignTable(data, value, htmlID, checType) {
    if (data) {
        var richTextId = [];// 富文本id
        var textValue = {};
        var newStr = "";
        $.each(data, function (i, v) {
            var leixing = v["类型"];
            var zhushi = v["注释"] || "";
            var TMleixing = v["标题类型"];
            var contentText = (checkValIsUndefinedOrNull(value[v["列名"]]) ? "" : retrieveUnequa(value[v["列名"]]));
            if (TMleixing == 0) {
                if (leixing == "0") {// 文本
                    var txt = v['限制'];
                    var idName = 'txt_' + v["ID"] + '_' + v["列名"];
                    if (txt == "" || txt == null) {//文本默认
                        textValue[idName] = contentText;
                        newStr += '<li>'
                            + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="writerText margl"> 共输入<i style="color: #f00;"> ' + contentText.replace(/\s|\r|\n/g, "").length + ' </i>字符</span><span class="statement margl">' + zhushi + '</span></p>'
                            + '<input id="' + idName + '" type="text" class="easyui-textbox" data-options="multiline:true,height:100" style="width: 100%">'
                            + '</li>';
                    } else {
                        txt = txt.split("-")[1];
                        if (txt <= 80) {
                            textValue[idName] = contentText;
                            newStr += '<li>'
                                + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="writerText margl"> 共输入<i style="color: #f00;"> ' + contentText.replace(/\s|\r|\n/g, "").length + ' </i>字符</span><span class="statement margl">' + zhushi + '</span></p>'
                                + '<input id="' + idName + '" type="text" class="easyui-textbox" data-options="multiline:true,height:30" style="width: 100%"/>'
                                + '</li>';
                        } else {
                            textValue[idName] = contentText;
                            newStr += '<li>'
                                + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="writerText margl"> 共输入<i style="color: #f00;"> ' + contentText.replace(/\s|\r|\n/g, "").length + ' </i>字符</span><span class="statement margl">' + zhushi + '</span></p>'
                                + '<input id="' + idName + '" type="text" class="easyui-textbox" data-options="multiline:true,height:100" style="width: 100%">'
                                + '</li>';
                        };
                    };
                };
                if (leixing == "1") {//数字
                    var idName = 'txt_' + v["ID"] + '_' + v["列名"];
                    newStr += '<li>'
                        + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="writerText margl"> 共输入<i style="color: #f00;"> ' + ("" + contentText).length + ' </i>字符</span><span class="statement margl">' + zhushi + '</span></p>'
                        + '<input id="' + idName + '" type="text" class="easyui-textbox" data-options="multiline:true,height:30" value="' + contentText + '" style="width: 100%"/>'
                        + '</li>';
                };
                if (leixing == "2") {//单选
                    var idName = 'radio_' + v["ID"] + '_' + v["列名"];
                    newStr += '<li>'
                        + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></p>'
                        + '<div class="designTable_radio">';
                    if (v["中文列名"] !== "") {
                        var raido = v["中文列名"].split(",");
                        for (var i = 0; i < raido.length; i++) {
                            if (value[v["列名"]] == i) {
                                newStr += '<input class="margl" type="radio" id="' + idName + i + '" name="' + idName + '" value="' + i + '" checked="checked"/>' + '<label for="' + idName + i + '">' + raido[i] + '</label>'
                            } else {
                                newStr += '<input class="margl" type="radio" id="' + idName + i + '" name="' + idName + '" value="' + i + '" />' + '<label for="' + idName + i + '">' + raido[i] + '</label>'
                            };
                        };
                    };
                    newStr += '</div></li>';
                };
                if (leixing == "3") {//多选
                    var idName = '';
                    newStr += '<li>'
                        + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></p>'
                        + '<div class="designTable_radio">';
                    if (v["中文列名"] !== "") {
                        var raido = v["中文列名"].split(",");
                        var id = v["列名"].split(",")
                        for (var i = 0; i < raido.length; i++) {
                            idName = 'checkbox_' + v["ID"] + '_' + id[i];
                            if (value[v["列名"].split(",")[i]] == '1') {
                                newStr += '<input class="margl" type="checkbox" id="' + idName + '" value="' + i + '" checked="checked"/>' + '<label for="' + idName + '">' + raido[i] + '</label>'
                            } else {
                                newStr += '<input class="margl" type="checkbox" id="' + idName + '" value="' + i + '" />' + '<label for="' + idName + '">' + raido[i] + '</label>'
                            };
                        };
                    };
                    newStr += '</div></li>';
                };
                if (leixing == "4") {//时间
                    var idName = 'txt_' + v["ID"] + '_' + v["列名"];
                    //newStr += '<li>'
                    //            + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></p>'
                    //            + '<input id="' + v["列名"] + v["ID"] + '" type="text" class="easyui-textbox" data-options="multiline:true,height:30" />'
                    //            + '</li>';
                };
                if (leixing == "6") {//富文本
                    var idName = 'txt_' + v["ID"] + '_' + v["列名"];
                    richTextId.push(idName);
                    newStr += '<li>'
                        + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="writerText margl"> 共输入<i style="color: #f00;"> ' + contentText.replace(/\s|\r|\n/g, "").length + ' </i>字符</span><span class="statement margl">' + zhushi + '</span></p>'
                        + '<textarea class="ad-txt" id="' + idName + '" name="' + idName + '" style="width: 100%; height: 500px;">' + contentText + '</textarea>'
                        + '</li>';
                };
                if (leixing == 7) {//只显示标题 不显示内容
                    newStr += '<li>'
                        + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></p>'
                        + '</li>';
                };
            } else if (TMleixing == 1) {
                //二级自定义标题
                if (leixing == "0") {//文本
                    var name = "txt_" + v['ID'] + "_" + v['列名'];
                    var txtLen = v['限制'];
                    if (txtLen == "" || txtLen == null) {
                        textValue["txt_" + v['ID'] + "_" + v['列名']] = contentText;
                        newStr += '<li><div class="gxf_designTable_secondTitle">'
                            + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="writerText margl"> 共输入<i style="color: #f00;">' + contentText.replace(/\s|\r|\n/g, "").length + '</i>字符</span><span class="statement margl">' + zhushi + '</span></h3>'
                            + '<input id="txt_' + v['ID'] + '_' + v['列名'] + '" type="text" class="easyui-textbox" data-options="multiline:true,height:100" style="width: 100%">'
                            + '</div></li>';
                    } else {
                        txtLen = txtLen.split("-");
                        if (txtLen[1] <= 80) {// 文本长度小于80
                            textValue["txt_" + v['ID'] + "_" + v['列名']] = contentText;
                            newStr += '<li><div class="gxf_designTable_secondTitle">'
                                + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="writerText margl"> 共输入<i style="color: #f00;">' + contentText.replace(/\s|\r|\n/g, "").length + '</i>字符</span><span class="statement margl">' + zhushi + '</span></h3>'
                                + '<input id="txt_' + v['ID'] + '_' + v['列名'] + '" type="text" class="easyui-textbox" data-options="multiline:true,height:30" style="width: 100%">'
                                + '</div></li>';
                        } else {// 文本长度大于
                            textValue["txt_" + v['ID'] + "_" + v['列名']] = contentText;
                            newStr += '<li><div class="gxf_designTable_secondTitle">'
                                + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="writerText margl"> 共输入<i style="color: #f00;">' + contentText.replace(/\s|\r|\n/g, "").length + '</i>字符</span><span class="statement margl">' + zhushi + '</span></h3>'
                                + '<input id="txt_' + v['ID'] + '_' + v['列名'] + '" type="text" class="easyui-textbox" data-options="multiline:true,height:100" style="width: 100%">'
                                + '</div></li>';
                        };
                    };
                };
                if (leixing == "1") {//数字
                    var name = "txt_" + v['ID'] + "_" + v['列名'];
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="writerText margl"> 共输入<i style="color: #f00;">' + ("" + contentText).length + '</i>字符</span><span class="statement margl">' + zhushi + '</span></h3>'
                        + '<input id="txt_' + v['ID'] + '_' + v['列名'] + '" type="text" class="easyui-textbox" data-options="multiline:true,height:30" value="' + contentText + '" style="width: 100%">'
                        + '</div></li>';
                };
                if (leixing == "2") {//单选
                    var idName = 'radio_' + v["ID"] + '_' + v["列名"];
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></h3>'
                        + '<div class="designTable_radio">';
                    if (v["中文列名"] !== "") {
                        var raido = v["中文列名"].split(",");
                        for (var i = 0; i < raido.length; i++) {
                            if (value[v["列名"]] == i) {
                                newStr += '<input class="margl" type="radio" id="' + idName + i + '" name="' + idName + '" value="' + i + '" checked="checked"/>' + '<label  for="' + idName + i + '">' + raido[i] + '</label>';
                            } else {
                                newStr += '<input class="margl" type="radio" id="' + idName + i + '" name="' + idName + '" value="' + i + '" />' + '<label for="' + idName + i + '">' + raido[i] + '</label>';
                            };
                        };
                    };
                    newStr += '</div></li>';
                };
                if (leixing == "3") {//多选
                    var idName = '';
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></h3>'
                        + '<div class="designTable_radio">';
                    if (v["中文列名"] !== "") {
                        var raido = v["中文列名"].split(",");
                        var id = v["列名"].split(",")
                        for (var i = 0; i < raido.length; i++) {
                            idName = 'checkbox_' + v["ID"] + '_' + id[i];
                            if (value[v["列名"].split(",")[i]] == '1') {
                                newStr += '<input class="margl" type="checkbox" id="' + idName + '" value="' + i + '" checked="checked"/>' + '<label for="' + idName + '">' + raido[i] + '</label>'
                            } else {
                                newStr += '<input class="margl" type="checkbox" id="' + idName + '" value="' + i + '" />' + '<label for="' + idName + '">' + raido[i] + '</label>'
                            };
                        };
                    };
                    newStr += '</div></li>';
                };
                if (leixing == "4") {//时间
                    var name = "txt_" + v['ID'] + "_" + v['列名'];
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></h3>'
                        + '<div style="width:958px; background:#fff;border:1px solid #ddd; padding:8px 10px;">'
                        + '<input id="' + name + '" class="easyui-datetimebox" data-options="showSeconds:false,editable: false,height:26,width:180" panelheight="260" />'
                        //+ '<span>至</span>'
                        //+ '<input id="TimeEnd" class="easyui-datetimebox" data-options="showSeconds:false,editable: false,height:26,width:180" panelheight="260" />'
                        + '</div></li>';
                };
                if (leixing == "6") {//富文本
                    var name = "txt_" + v['ID'] + "_" + v['列名'];
                    richTextId.push(name);
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="writerText margl"> 共输入<i style="color: #f00;">' + contentText.replace(/\s|\r|\n/g, "").length + '</i>字符</span><span class="statement margl">' + zhushi + '</span></h3>'
                        + '<textarea class="ad-txt" id="' + name + '" name="' + name + '" style="width: 100%; height: 500px;">' + contentText + '</textarea>'
                        + '</div></li>';
                };
                if (leixing == 7) {//只显示标题 不显示内容
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + ' <span class="statement margl">' + zhushi + '</span></h3>'
                        + '</div></li>';
                };
            };
        });
        if (checType) {
            var obj = {
                str: newStr,
                txt: textValue
            };
            return obj;
        } else {
            $("#" + htmlID).append(newStr);         //添加到页面
            $.parser.parse('#' + htmlID);       // 重新渲染页面
            $.each(textValue, function (i, v) {
                $("#" + i).textbox("setText", retrieveUnequa(v));
            });
            if (richTextId.length > 0) {
                initKindEditor(richTextId);                 // 富文本编辑框初始化
            };
            $.each(data, function (i, v) {
                if (v['类型'] == 0 || v['类型'] == 1) {
                    showWriteTextNumber.createNew(htmlID, "txt_" + v['ID'] + "_" + v['列名']);
                };
            });
        };
    };
};

/*
    * 自定义表-详情-没有划词
    * data   自定义表
    * value  提交的数据
    * htmlID  页面ul的id
    * checType  是否直接返回html字符串（审核用）
*/
function GetDetailesDesignTable(data, value, htmlID, checType) {
    if (data) {
        var newStr = "";
        $.each(data, function (i, v) {
            var leixing = v["类型"];
            var zhushi = v["注释"] || "";
            var TMleixing = v["标题类型"];
            var contentText = (checkValIsUndefinedOrNull(value[v["列名"]]) ? "" : retrieveUnequa(value[v["列名"]]));
            if (TMleixing == 0) {
                // 一级标题
                if (leixing == "0") {// 文本
                    newStr += '<li>'
                        + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />'))
                    newStr += '<span class="writerText margl"> 共输入<i style="color: #f00;">' + getTextNumber(contentText) + '</i>字符</span>';
                    if (!checkValIsUndefinedOrNull(value["检测状态"]) && value["检测状态"] != '-1') {
                        newStr += '<span class="margl" style="font-size: 12px;">' + GetCheckResult(11, value["文件ID"], v["ID"], 1) + '</span>';
                    }
                    newStr += '<span class="statement margl">' + zhushi + '</span></p>'
                        + '<div id="txt_' + v["ID"] + '_' + v["列名"] + '" class="gxf_designTable_detailes clearfix">' + (replaceBr(contentText).replace(/\s/g, "&nbsp;")) + '</div>'
                        + '</li>';
                };
                if (leixing == "1") {// 数字
                    newStr += '<li>'
                        + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></p>'
                        + '<div id="txt_' + v["ID"] + '_' + v["列名"] + '" class="gxf_designTable_detailes clearfix">' + (contentText) + '</div>'
                        + '</li>';
                };
                if (leixing == "2") {// 单选框
                    newStr += '<li>'
                        + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></p>'
                        + '<div class="gxf_designTable_detailes">';
                    if (v["中文列名"] !== "") {
                        var raido = v["中文列名"].split(",");
                        for (var i = 0; i < raido.length; i++) {
                            if (value[v['列名']] == i) {
                                newStr += '<input type="radio" id="' + v["列名"] + i + '" name="radio_' + v['ID'] + '_' + v["列名"] + '" value="' + i + '" checked="checked" disabled="disabled"/>' + ' <label for="' + v["列名"] + i + '" class="margr">' + raido[i] + '</label>';
                            } else {
                                newStr += '<input type="radio" id="' + v["列名"] + i + '" name="radio_' + v['ID'] + '_' + v["列名"] + '" value="' + i + '" disabled="disabled"/>' + ' <label for="' + v["列名"] + i + '" class="margr" >' + raido[i] + '</label>';
                            };
                        };
                    };
                    newStr += '</div></li>';
                };
                if (leixing == "3") {//多选
                    newStr += '<li>'
                        + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></p>'
                        + '<div class="gxf_designTable_detailes">';
                    if (v["中文列名"] !== "") {
                        var raido = v["中文列名"].split(",");
                        for (var i = 0; i < raido.length; i++) {
                            var idName = 'checkbox_' + v["ID"] + '_' + raido[i];
                            if (value[v['列名'].split(",")[i]] == 1) {
                                newStr += '<input type="checkbox" id="' + idName + '"  value="' + i + '" checked="checked" disabled="disabled"/>' + ' <label for="' + idName + '" class="margr">' + raido[i] + '</label>';
                            } else {
                                newStr += '<input type="checkbox" id="' + idName + '"  value="' + i + '" disabled="disabled"/>' + ' <label for="' + idName + '" class="margr">' + raido[i] + '</label>';
                            };
                        };
                    };
                    newStr += '</div></li>';
                };
                if (leixing == "4") {
                    //newStr += '<li>'
                    //+ '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></p>'
                    //+ '<div class="gxf_designTable_detailes">' + value[v['列名']] + '</div>'
                    //+ '</li>';
                };
                if (leixing == "6") {// 富文本
                    newStr += '<li>'
                        + '<p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />'))
                    //if (!checkValIsUndefinedOrNull(value["检测状态"]) && value["检测状态"] != '-1') {
                    //    newStr += '<span class="margl" style="font-size: 12px;">' + GetCheckResult(11, value["文件ID"], v["ID"], 1) + '</span>';
                    //}
                    //newStr += '<span class="writerText margl"> 共输入<i style="color: #f00;">' + getTextNumber(contentText) + '</i>字符</span>';
                    newStr += '<span class="statement margl">' + zhushi + '</span></p>';
                    newStr += '<div id="txt_' + v["ID"] + '_' + v["列名"] + '" class="gxf_designTable_detailes clearfix">' + (contentText) + '</div>'
                    newStr += '</li>';
                };
                if (leixing == 7) {//只显示标题 不显示内容
                    newStr += '<li><p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></p></li>';
                };
            } else if (TMleixing == 1) {
                // 二级标题
                if (leixing == "0") {//文本
                    var name = "txt_" + v['ID'] + "_" + v['列名'];
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>'
                    newStr += '<span class="writerText margl"> 共输入<i style="color: #f00;">' + getTextNumber(contentText) + '</i>字符</span>';
                    if (!checkValIsUndefinedOrNull(value["检测状态"]) && value["检测状态"] != '-1') {
                        newStr += '<span class="margl" style="font-size: 12px;">' + GetCheckResult(11, value["文件ID"], v["ID"], 1) + '</span>';
                    }
                    newStr += (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></h3>'
                        + '<div id="txt_' + v["ID"] + '_' + v["列名"] + '" class="gxf_designTable_detailes clearfix"> ' + (replaceBr(contentText).replace(/\s/g, "&nbsp;"))
                        + '</div></div></li>';
                };
                if (leixing == "1") {//数字
                    var name = "txt_" + v['ID'] + "_" + v['列名'];
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></h3>'
                        + '<div id="txt_' + v["ID"] + '_' + v["列名"] + '" class="gxf_designTable_detailes clearfix"> ' + contentText
                        + '</div></div></li>';
                };
                if (leixing == "2") {//单选
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></h3>'
                        + '<div class="gxf_designTable_detailes clearfix"> '
                    if (v["中文列名"] !== "") {
                        var raido = v["中文列名"].split(",");
                        for (var i = 0; i < raido.length; i++) {
                            if (value[v['列名']] == i) {
                                newStr += '<input type="radio" id="' + v["列名"] + i + '" name="radio_' + v['ID'] + '_' + v["列名"] + '" value="' + i + '" checked="checked" disabled="disabled"/>' + '<label for="' + v["列名"] + i + '" class="margr">' + raido[i] + '</label>'
                            } else {
                                newStr += '<input type="radio" id="' + v["列名"] + i + '" name="radio_' + v['ID'] + '_' + v["列名"] + '" value="' + i + '" disabled="disabled"/>' + '<label for="' + v["列名"] + i + '" class="margr">' + raido[i] + '</label>'
                            };
                        };
                    };
                    newStr += '</div></div></li>';;
                };
                if (leixing == "3") {//多选
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></h3>'
                        + '<div class="gxf_designTable_detailes clearfix"> '
                    if (v["中文列名"] !== "") {
                        var raido = v["中文列名"].split(",");
                        for (var i = 0; i < raido.length; i++) {
                            var idName = 'checkbox_' + v["ID"] + '_' + raido[i];
                            if (value[v['列名'].split(",")[i]] == 1) {
                                newStr += '<input type="checkbox" id="' + idName + '"  value="' + i + '" checked="checked" disabled="disabled"/>' + '<label for="' + idName + '" class="margr">' + raido[i] + '</label>'
                            } else {
                                newStr += '<input type="checkbox" id="' + idName + '"  value="' + i + '" disabled="disabled"/>' + '<label for="' + idName + '" class="margr">' + raido[i] + '</label>'
                            };
                        };
                    };
                    newStr += '</div></div></li>';
                };
                if (leixing == "4") {//时间
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></h3>'
                        + '<div id="txt_' + v["ID"] + '_' + v["列名"] + '" class="gxf_designTable_detailes clearfix"> ' + replaceBr(contentText)
                        + '</div></div></li>';
                };
                if (leixing == "6") {//富文本
                    var name = "txt_" + v['ID'] + "_" + v['列名'];
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />'))
                    //if (!checkValIsUndefinedOrNull(value["检测状态"]) && value["检测状态"] != '-1') {
                    //    newStr += '<span class="margl" style="font-size: 12px;">' + GetCheckResult(11, value["文件ID"], v["ID"], 1) + '</span>';
                    //}
                    //newStr += '<span class="writerText margl"> 共输入<i style="color: #f00;">' + getTextNumber(contentText) + '</i>字符</span>';
                    newStr += '<span class="statement margl">' + zhushi + '</span></h3>';
                    newStr += '<div id="txt_' + v["ID"] + '_' + v["列名"] + '" class="gxf_designTable_detailes clearfix">' + (contentText);
                    newStr += '</div></div></li>';
                };
                if (leixing == 7) {//只显示标题 不显示内容
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + ' <span class="statement margl">' + zhushi + '</span></h3>'
                        + '</div></li>';
                };
            };
        });
        if (checType) {
            return newStr;
        } else {
            $("#" + htmlID).append(newStr);      // 添加到页面
            $.parser.parse("#" + htmlID);             // 重新渲染
        };
    };
};

/*
    * 自定义表-详情-有划词
    * data   自定义表
    * value  提交的数据
    * htmlID  页面ul的id
    * rangyType  划词参数 type
*/
function GetDetailesDesignTableForRangy(data, value, htmlID, rangyType) {
    if (data) {
        var newStr = '';
        $.each(data, function (i, v) {
            var TMleixing = v["标题类型"];
            var leixing = v["类型"];
            var zhushi = v["注释"] || "";
            var contentText = (checkValIsUndefinedOrNull(value[v["列名"]]) ? "" : retrieveUnequa(value[v["列名"]]));
            if (TMleixing == 0) {// 一级标题
                if (leixing == "0") {// 文本
                    newStr += '<li><p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />'));
                    newStr += '<span class="writerText margl"> 共输入<i style="color: #f00;">' + getTextNumber(contentText) + '</i>字符</span>';
                    if (!checkValIsUndefinedOrNull(value["检测状态"]) && value["检测状态"] != '-1') {
                        newStr += '<span class="margl" style="font-size: 12px;">' + GetCheckResult(11, value["文件ID"], v["ID"], 1) + '</span>';
                    }
                    newStr += '<span class="statement margl">' + zhushi + '</span></p>'
                        + '<div class="gxf_designTable_rangy clearfix">'
                        + '<div id="left_' + v["列名"] + '" tableModelId = "' + v["ID"] + '" class="gxf_rangy_left"><p><span>' + (contentText.replace(/(\n\n\n)|(\n\n)|\n/g, '</span></p><p><span>').replace(/\s/g, '&nbsp;')) + '</span></p></div>'
                        + '<div id="right_box_left_' + v["列名"] + '" class="gxf_rangy_right_box"><p class="gxf_rangy_right_top">支持左侧选择文字批注，也支持★<a class="listA rangy_all" href="javascript:;">整体批注</a></p>'
                        + '<ul id="right_left_' + v["列名"] + '" class="gxf_rangy_right"></ul></div>'
                        + '</div></li>';
                };
                if (leixing == "1") {//数字
                    newStr += '<li><p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></p>'
                        + '<div class="gxf_designTable_rangy clearfix">'
                        + '<div class="gxf_rangy_left gxf_noRangy">' + contentText + '</div>'
                        + '<div id="right_box_left_' + v["列名"] + '" class="gxf_rangy_right_box gxf_noRangy">'
                        + '<ul class="gxf_rangy_right gxf_noRangy"><li class="gxf_rangy_noContent"><h3>该内容暂不支持批注</h3></li></ul>'
                        + '</div></div></li>';
                };
                if (leixing == "2") {// 单选框
                    newStr += '<li><p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></p>'
                        + '<div class="gxf_designTable_rangy clearfix">'
                        + '<div class="gxf_rangy_left gxf_noRangy">';
                    if (v["中文列名"] !== "") {
                        var raido = v["中文列名"].split(",");
                        for (var i = 0; i < raido.length; i++) {
                            if (value[v['列名']] == i) {
                                newStr += '<input type="radio" id="' + v["列名"] + i + '" name="radio_' + v['ID'] + '_' + v["列名"] + '" value="' + i + '" checked="checked" disabled="disabled"/>' + ' <label for="' + v["列名"] + i + '" class="margr">' + raido[i] + '</label>';
                            } else {
                                newStr += '<input type="radio" id="' + v["列名"] + i + '" name="radio_' + v['ID'] + '_' + v["列名"] + '" value="' + i + '" disabled="disabled"/>' + ' <label for="' + v["列名"] + i + '" class="margr" >' + raido[i] + '</label>';
                            };
                        };
                    };
                    newStr += '</div>'
                        + '<div id="right_box_left_' + v["列名"] + '" class="gxf_rangy_right_box gxf_noRangy">'
                        + '<ul class="gxf_rangy_right gxf_noRangy"><li class="gxf_rangy_noContent"><h3>该内容暂不支持批注</h3></li></ul></div></div></li>';
                };
                if (leixing == "3") {//多选
                    newStr += '<li><p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></p>'
                        + '<div class="gxf_designTable_rangy clearfix">'
                        + '<div class="gxf_rangy_left gxf_noRangy">';
                    if (v["中文列名"] !== "") {
                        var raido = v["中文列名"].split(",");
                        for (var i = 0; i < raido.length; i++) {
                            var idName = 'checkbox_' + v["ID"] + '_' + raido[i];
                            if (value[v['列名'].split(",")[i]] == 1) {
                                newStr += '<input type="checkbox" id="' + idName + '"  value="' + i + '" checked="checked" disabled="disabled"/>' + ' <label for="' + idName + '" class="margr">' + raido[i] + '</label>';
                            } else {
                                newStr += '<input type="checkbox" id="' + idName + '"  value="' + i + '" disabled="disabled"/>' + ' <label for="' + idName + '" class="margr">' + raido[i] + '</label>';
                            };
                        };
                    };
                    newStr += '</div>'
                        + '<div id="right_box_left_' + v["列名"] + '" class="gxf_rangy_right_box gxf_noRangy">'
                        + '<ul class="gxf_rangy_right gxf_noRangy"><li class="gxf_rangy_noContent"><h3>该内容暂不支持批注</h3></li></ul></div></div></li>';
                };
                if (leixing == "4") {
                    newStr += '<li><p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></p>'
                        + '<div class="gxf_designTable_rangy clearfix">'
                        + '<div class="gxf_rangy_left gxf_noRangy">' + contentText + '</div>'
                        + '<div id="right_box_left_' + v["列名"] + '" class="gxf_rangy_right_box gxf_noRangy">'
                        + '<ul class="gxf_rangy_right gxf_noRangy"><li class="gxf_rangy_noContent"><h3>该内容暂不支持批注</h3></li></ul>'
                        + '</div></div></li>';
                };
                if (leixing == "6") {//富文本
                    newStr += '<li><p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />'))
                    //if (!checkValIsUndefinedOrNull(value["检测状态"]) && value["检测状态"] != '-1') {
                    //    newStr += '<span class="margl" style="font-size: 12px;">' + GetCheckResult(11, value["文件ID"], v["ID"], 1) + '</span>';
                    //}
                    //newStr += '<span class="writerText margl"> 共输入<i style="color: #f00;">' + getTextNumber(contentText) + '</i>字符</span>';
                    newStr += '<span class="statement margl">' + zhushi + '</span></p>'
                        + '<div class="gxf_designTable_rangy clearfix">'
                        + '<div id="left_' + v["列名"] + '" tableModelId = "' + v["ID"] + '" class="gxf_rangy_left"><p><span>' + (contentText.replace(/(\n\n\n)|(\n\n)|\n/g, '</span></p><p><span>')) + '</span></p></div>'
                        + '<div id="right_box_left_' + v["列名"] + '" class="gxf_rangy_right_box"><p class="gxf_rangy_right_top">支持左侧选择文字批注，也支持★<a class="listA rangy_all" href="javascript:;">整体批注</a></p>'
                        + '<ul id="right_left_' + v["列名"] + '" class="gxf_rangy_right"></ul>'
                        + '</div></div></li>';
                };
                if (leixing == 7) {//只显示标题 不显示内容
                    newStr += '<li><p style="margin-left: 5px;">' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></p></li>';
                };
            } else if (TMleixing == 1) {
                // 二级标题
                if (leixing == "0") {//文本
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />'));
                    newStr += '<span class="writerText margl"> 共输入<i style="color: #f00;">' + getTextNumber(contentText) + '</i>字符</span>';
                    if (!checkValIsUndefinedOrNull(value["检测状态"]) && value["检测状态"] != '-1') {
                        newStr += '<span class="margl" style="font-size: 12px;">' + GetCheckResult(11, value["文件ID"], v["ID"], 1) + '</span>';
                    }
                    newStr += '<span class="statement margl">' + zhushi + '</span></h3>'
                        + '<div class="gxf_designTable_rangy clearfix">'
                        + '<div id="left_' + v["列名"] + '" tableModelId = "' + v["ID"] + '" class="gxf_rangy_left"><p><span>' + (contentText.replace(/(\n\n\n)|(\n\n)|\n/g, '</span></p><p><span>').replace(/\s/g, '&nbsp;')) + '</span></p></div>'
                        + '<div id="right_box_left_' + v["列名"] + '" class="gxf_rangy_right_box"><p class="gxf_rangy_right_top">支持左侧选择文字批注，也支持★<a class="listA rangy_all" href="javascript:;">整体批注</a></p>'
                        + '<ul id="right_left_' + v["列名"] + '" class="gxf_rangy_right"></ul>'
                        + '</div></div></div></li>';
                };
                if (leixing == "1") {//数字
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></h3>'
                        + '<div class="gxf_designTable_rangy clearfix">'
                        + '<div class="gxf_rangy_left gxf_noRangy">' + (contentText) + '</div>'
                        + '<div id="right_box_left_' + v["列名"] + '" class="gxf_rangy_right_box gxf_noRangy">'
                        + '<ul class="gxf_rangy_right gxf_noRangy"><li class="gxf_rangy_noContent"><h3>该内容暂不支持批注</h3></li></ul>'
                        + '</div></div></div></li>';
                };
                if (leixing == "2") {//单选
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></h3>'
                        + '<div class="gxf_designTable_rangy clearfix">'
                        + '<div class="gxf_rangy_left gxf_noRangy">';
                    if (v["中文列名"] !== "") {
                        var raido = v["中文列名"].split(",");
                        for (var i = 0; i < raido.length; i++) {
                            if (value[v['列名']] == i) {
                                newStr += '<input type="radio" id="' + v["列名"] + i + '" name="radio_' + v['ID'] + '_' + v["列名"] + '" value="' + i + '" checked="checked" disabled="disabled"/>' + ' <label for="' + v["列名"] + i + '" class="margr">' + raido[i] + '</label>';
                            } else {
                                newStr += '<input type="radio" id="' + v["列名"] + i + '" name="radio_' + v['ID'] + '_' + v["列名"] + '" value="' + i + '" disabled="disabled"/>' + ' <label for="' + v["列名"] + i + '" class="margr" >' + raido[i] + '</label>';
                            };
                        };
                    };
                    newStr += '</div>'
                        + '<div id="right_box_left_' + v["列名"] + '" class="gxf_rangy_right_box gxf_noRangy">'
                        + '<ul class="gxf_rangy_right gxf_noRangy"><li class="gxf_rangy_noContent"><h3>该内容暂不支持批注</h3></li></ul></div></div></div></li>';
                };
                if (leixing == "3") {//多选
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></h3>'
                        + '<div class="gxf_designTable_rangy clearfix">'
                        + '<div class="gxf_rangy_left gxf_noRangy">';
                    if (v["中文列名"] !== "") {
                        var raido = v["中文列名"].split(",");
                        for (var i = 0; i < raido.length; i++) {
                            var idName = 'checkbox_' + v["ID"] + '_' + raido[i];
                            if (value[v['列名'].split(",")[i]] == 1) {
                                newStr += '<input type="checkbox" id="' + idName + '"  value="' + i + '" checked="checked" disabled="disabled"/>' + ' <label for="' + idName + '" class="margr">' + raido[i] + '</label>';
                            } else {
                                newStr += '<input type="checkbox" id="' + idName + '"  value="' + i + '" disabled="disabled"/>' + ' <label for="' + idName + '" class="margr">' + raido[i] + '</label>';
                            };
                        };
                    };
                    newStr += '</div>'
                        + '<div id="right_box_left_' + v["列名"] + '" class="gxf_rangy_right_box gxf_noRangy">'
                        + '<ul class="gxf_rangy_right gxf_noRangy"><li class="gxf_rangy_noContent"><h3>该内容暂不支持批注</h3></li></ul></div></div></div></li>';
                };
                if (leixing == "4") {//时间
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + '<span class="statement margl">' + zhushi + '</span></h3>'
                        + '<div class="gxf_designTable_rangy clearfix">'
                        + '<div class="gxf_rangy_left gxf_noRangy">' + (contentText) + '</div>'
                        + '<div id="right_box_left_' + v["列名"] + '" class="gxf_rangy_right_box gxf_noRangy">'
                        + '<ul class="gxf_rangy_right gxf_noRangy"><li class="gxf_rangy_noContent"><h3>该内容暂不支持批注</h3></li></ul>'
                        + '</div></div></div></li>';
                };
                if (leixing == "6") {//富文本
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />'))
                    //if (!checkValIsUndefinedOrNull(value["检测状态"]) && value["检测状态"] != '-1') {
                    //    newStr += '<span class="margl" style="font-size: 12px;">' + GetCheckResult(11, value["文件ID"], v["ID"], 1) + '</span>';
                    //}
                    //newStr += '<span class="writerText margl"> 共输入<i style="color: #f00;">' + getTextNumber(contentText) + '</i>字符</span>';
                    newStr += '<span class="statement margl">' + zhushi + '</span></h3>'
                        + '<div class="gxf_designTable_rangy clearfix">'
                        + '<div id="left_' + v["列名"] + '" tableModelId = "' + v["ID"] + '" class="gxf_rangy_left"><p><span>' + (contentText.replace(/(\n\n\n)|(\n\n)|\n/g, '</span></p><p><span>')) + '</span></p></div>'
                        + '<div id="right_box_left_' + v["列名"] + '" class="gxf_rangy_right_box"><p class="gxf_rangy_right_top">支持左侧选择文字批注，也支持★<a class="listA rangy_all" href="javascript:;">整体批注</a></p>'
                        + '<ul id="right_left_' + v["列名"] + '" class="gxf_rangy_right"></ul>'
                        + '</div></div></div></li>';
                };
                if (leixing == 7) {//只显示标题 不显示内容
                    newStr += '<li><div class="gxf_designTable_secondTitle">'
                        + '<h3 class="gxf_designTable_secondTitle_Title"><i> </i>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />')) + ' <span class="statement margl">' + zhushi + '</span></h3>'
                        + '</div></li>';
                };
            };
        });
        $("#" + htmlID).append(newStr);      // 添加到页面
        $.parser.parse("#" + htmlID);             // 重新渲染
        $.each(data, function (idx, val) {// 划词
            if (val["类型"] == 0 || val["类型"] == 6) {
                //$("#right_left_" + val['列名']).height($("#right_left_" + val['列名']).siblings('#left_' + val['列名']).height());
                var submitid = value["文件ID"];
                RangyHelper.createNew('left_' + val["列名"], '', submitid, rangyType, val["ID"]);
            };
        });
        $(window).resize(function () {
            $.each(data, function (idx, val) {
                if (val["类型"] == 0 || val["类型"] == 6) {
                    ChangeTheHeight(("left_" + val['列名']));
                }
            });
        });
    }
};

//  非自定义划词详情
function GetDetailesNoDesignTableForRangy(data, value, htmlID) {
    if (data) {
        var newStr = '';
        $.each(data, function (i, v) {
            var TMleixing = v["标题类型"];
            var leixing = v["类型"];
            var zhushi = v["注释"] || "";
            var contentText = (checkValIsUndefinedOrNull(value[v["中文列名"]]) ? "" : (value[v["中文列名"]] == 'DesignTable' ? "" : retrieveUnequa(value[v["中文列名"]])));
            if (TMleixing == 0) {// 一级标题
                if (leixing == "0") {// 文本
                    newStr += '<li><p>' + (v['题目'].replace(/#cnkibrcnki#/g, '<br />'));
                    newStr += '<span class="writerText margl"> 共输入<i style="color: #f00;">' + getTextNumber(contentText) + '</i>字符</span>';
                    if (!checkValIsUndefinedOrNull(value["检测状态"]) && value["检测状态"] != '-1') {
                        newStr += '<span class="margl" style="font-size: 12px;">' + GetCheckResult(v["rangyType"], value["文件ID"], "", 0) + '</span>';
                    }
                    newStr += '<span class="statement margl">' + zhushi + '</span></p>'
                        + '<div class="gxf_designTable_rangy clearfix">'
                        + '<div id="left_' + v["列名"] + '" class="gxf_rangy_left"><p><span>' + (contentText.replace(/(\n\n\n)|(\n\n)|\n/g, '</span></p><p><span>').replace(/\s/g, '&nbsp;')) + '</span></p></div>'
                        + '<div id="right_box_left_' + v["列名"] + '" class="gxf_rangy_right_box"><p class="gxf_rangy_right_top">支持左侧选择文字批注，也支持★<a class="listA rangy_all" href="javascript:;">整体批注</a></p>'
                        + '<ul id="right_left_' + v["列名"] + '" class="gxf_rangy_right"></ul></div>'
                        + '</div></li>';
                }
            }
        });
        $("#" + htmlID).append(newStr);      // 添加到页面
        $.parser.parse("#" + htmlID);             // 重新渲染
        $.each(data, function (idx, val) {   // 划词
            if (val["类型"] == 0 || val["类型"] == 6) {
                var submitid = value["文件ID"];
                RangyHelper.createNew('left_' + val["列名"], '', submitid, val['rangyType'], "");
            };
        });
        $(window).resize(function () {
            $.each(data, function (idx, val) {
                if (val["类型"] == 0 || val["类型"] == 6) {
                    ChangeTheHeight(("left_" + val['列名']));
                }
            });
        });
    }
};

// 调整划词左右框的高度
function ChangeTheHeight(idName) {
    var leftHeight = $("#" + idName).height();
    var rightBoxHeight = $("#right_box_" + idName).height();
    var rightTopHeight = $("#right_box_" + idName).find(".gxf_rangy_right_top").height();
    var rightHeight = $("#right_" + idName).height();

    if (rightTopHeight > 41) {
        if (leftHeight < (rightTopHeight + 17 + 58)) {
            $("#" + idName + ",#right_box_" + idName).height((rightTopHeight + 17 + 58));
        } else {
            $("#right_box_" + idName).height($("#" + idName).height());
        }
    } else {
        if (leftHeight < (rightTopHeight + 17 + 58)) {
            $("#" + idName + ",#right_box_" + idName).height((rightTopHeight + 17 + 58));
        } else {
            $("#right_box_" + idName).height($("#" + idName).height());
        }
    }

    $("#right_" + idName).height($("#right_box_" + idName).height() - $("#right_box_" + idName).find(".gxf_rangy_right_top").height() - 17);
};

/*
* 自定义表-提交传参
* DesignTable   自定义表
* params  提交的data对象
*/
function submitDesignTableValue(DesignTable, params) {
    if (DesignTable) {
        $.each(DesignTable, function (index, value) {
            var leixing = value['类型'];
            if (leixing == '0' || leixing == '1' || leixing == '4') {
                params['txt_' + value['ID'] + '_' + value['列名']] = replaceUnequa($('#txt_' + value['ID'] + '_' + value['列名']).textbox("getText"));
            };
            if (leixing == '2') {
                params['radio_' + value['ID'] + '_' + value['列名']] = $("input[name='radio_" + value['ID'] + "_" + value['列名'] + "']:checked").val();
            };
            if (leixing == '3') {
                if (value["列名"]) {
                    var raido = value["列名"].split(",");
                    for (var i = 0; i < raido.length; i++) {
                        if ($("#checkbox_" + value["ID"] + '_' + raido[i]).prop('checked') == true) {
                            params['checkbox_' + value['ID'] + '_' + raido[i]] = $("#checkbox_" + value["ID"] + '_' + raido[i]).val();
                        };
                    };
                };
            };
            if (leixing == 6) {
                params['txt_' + value['ID'] + '_' + value['列名']] = $('#txt_' + value['ID'] + '_' + value['列名']).val();
            }
        });
    };
    return params;
};

/*
* 检测结果
* type            文件类型
* id                文件id
* colunnID     自定义colunnID
* isDesign      是否自定义   1是 
* htmlID        页面显示位置 htmlID 
*/
function GetCheckResult(type, id, colunnID, isDesign, htmlID) {
    var html = "";
    $.ajax({
        url: "../Handler/GetCheck.ashx",
        data: {
            action: "GetCheckResult",
            type: type,
            ID: id,
            columnID: colunnID,
            isdesign: isDesign
        },
        dataType: "json",
        async: false,
        type: "POST",
        success: function (data) {
            if (data.isSuccess) {
                html = data.dataList[0]["检测结果"];
            } else {
                myMessage(data.message);
            };
        },
        error: function (err) {
            console.log(err);
        }
    });
    if (htmlID) {
        $("#" + htmlID).html(html);
    } else {
        return html;
    }
};


// 字符数
function getTextNumber(text) {
    var num = 0;
    if (!checkValIsUndefinedOrNull(text)) {
        num = text.replace(/\s|\r|\n/g, "").length;
    }
    return num;
};